<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>A single page Flask App to show data from ThingSpeak.com - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}

</style>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'center', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
    <link href="/extra/favicon.ico" rel="icon">

<link rel="canonical" href="/drafts/flask-app-show-data-from-thingspeak.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="python,flask,thingspeak,mobile" />
        <meta name="description" content="In this post, I&#39;ll run through how I set up a single page flask app that shows a temperature posted on ThingSpeak.com. ThingSpeak has nice looking graphs, but it is actually kind of hard to see the value of individual data points. I wanted to be able to see the most recent temperature point recorded by my ESP8266 WiFi weather station on a phone or tablet. By building a flask app and hosting it on Digital Ocean, I can now view the current temperature from anywhere." />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="A single page Flask App to show data from ThingSpeak.com"/>
        <meta property="og:url" content="/drafts/flask-app-show-data-from-thingspeak.html"/>
        <meta property="og:description" content="In this post, I&#39;ll run through how I set up a single page flask app that shows a temperature posted on ThingSpeak.com. ThingSpeak has nice looking graphs, but it is actually kind of hard to see the value of individual data points. I wanted to be able to see the most recent temperature point recorded by my ESP8266 WiFi weather station on a phone or tablet. By building a flask app and hosting it on Digital Ocean, I can now view the current temperature from anywhere."/>
        <meta property="article:published_time" content="2018-07-20" />
            <meta property="article:section" content="flask" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="flask" />
            <meta property="article:tag" content="thingspeak" />
            <meta property="article:tag" content="mobile" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link href="/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/css/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="/pages/about.html">
                             About
                          </a></li>
                         <li><a href="/pages/book.html">
                             Book
                          </a></li>
                         <li><a href="/pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="" title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="/category/flask.html" title="flask">flask</a></li>
                <li class="active">A single page Flask App to show data from ThingSpeak.com</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/drafts/flask-app-show-data-from-thingspeak.html"
                       rel="bookmark"
                       title="Permalink to A single page Flask App to show data from ThingSpeak.com">
                        A single page Flask App to show data from ThingSpeak.com
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-07-20T09:01:00-07:00"> Fri 20 July 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="/tag/python.html">python</a>
        /
	<a href="/tag/flask.html">flask</a>
        /
	<a href="/tag/thingspeak.html">thingspeak</a>
        /
	<a href="/tag/mobile.html">mobile</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In this post, I'll run through how I set up a single page flask app that shows a temperature posted on ThingSpeak.com. ThingSpeak has nice looking graphs, but it is actually kind of hard to see the value of individual data points. I wanted to be able to see the most recent temperature point recorded by my <a href="/micropython-upload-code.html">ESP8266 WiFi weather station</a> on a phone or tablet. By building a flask app and hosting it on Digital Ocean, I can now view the current temperature from anywhere.</p>
<div class="toc"><span class="toctitle">Table of contents:</span><ul>
<li><a href="#set-up-a-new-digital-ocean-droplet">Set up a new Digital Ocean Droplet</a><ul>
<li><a href="#create-a-new-droplet">Create a New Droplet</a></li>
<li><a href="#login-to-server-with-putty">Login to Server with PuTTY</a></li>
<li><a href="#create-a-non-root-sudo-user">Create a non-root sudo user</a></li>
<li><a href="#copy-ssh-keys-to-non-root-sudo-user">Copy SSH keys to non-root sudo user</a></li>
</ul>
</li>
<li><a href="#acquire-and-configure-domain-name">Acquire and configure domain name</a><ul>
<li><a href="#purchase-a-domain-name">Purchase a domain name</a></li>
<li><a href="#point-dns-severs-at-digital-ocean">Point DNS severs at Digital Ocean</a></li>
<li><a href="#link-the-domain-name-to-the-server-ip-address">Link the domain name to the server IP address</a></li>
</ul>
</li>
<li><a href="#build-the-flask-app">Build the Flask App</a><ul>
<li><a href="#install-packages">Install Packages</a></li>
<li><a href="#create-a-virtual-environment-and-install-flask">Create a Virtual Environment and install flask</a></li>
<li><a href="#build-the-first-simple-flask-app">Build the first simple flask app</a></li>
<li><a href="#testing-the-first-simple-flask-app">Testing the first simple flask app</a></li>
</ul>
</li>
<li><a href="#setting-up-uwsgi-nginx-and-systemctl">Setting up uWSGI, nginx and systemctl</a><ul>
<li><a href="#configuring-uwsgi">Configuring uWSGI</a></li>
<li><a href="#testing-uwsgi">Testing uWSGI</a></li>
<li><a href="#making-a-uwsgi-configuration-file">Making a uWSGI configuration file</a></li>
<li><a href="#making-a-systemd-file">Making a systemd file</a></li>
<li><a href="#test-with-systemctl">Test with systemctl</a></li>
</ul>
</li>
<li><a href="#add-bootstrap-styling">Add Bootstrap Styling</a></li>
<li><a href="#pull-the-temperature-with-requests">Pull the temperature with requests</a></li>
</ul>
</div>
<h2 id="set-up-a-new-digital-ocean-droplet">Set up a new Digital Ocean Droplet</h2>
<p>The flask app needs a server to run on. I choose Digital Ocean as my cloud server provider. After creating a new server, it is best practice to create a non-root sudo user.</p>
<h3 id="create-a-new-droplet">Create a New Droplet</h3>
<p>The <a href="http://flask.pocoo.org/docs/1.0/"><strong>flask</strong></a> single page web app will be hosted on <a href="https://www.digitalocean.com/">Digital Ocean</a>. Digital Ocean is hosts virtual private servers that run in the cloud. Setting up a server on Digital Ocean is pretty cheap ($5/month) and quick. I host [my <strong>Jupyter Hub</strong> server]({filename}//posts/jupyterhub/why_jupyter_hub.md} on Digital Ocean so I am also more familiar with spinning up their servers compared to Linode, AWS or other cloud providers.</p>
<p>Creating a new Digital Ocean cloud server, called a <em>Droplet</em> in Digital Ocean speak involves creating a new account on Digital Ocean, logging in and selecting <strong>Create --&gt; Droplets</strong> in the upper right menu.</p>
<p><img alt="DO create new droplet" src="{filename}/posts/flask/DO_create_new_droplet.PNG"></p>
<p>For the new Digital Ocean Droplet options I choose:</p>
<ul>
<li>Ubuntu 18.04.1 x64</li>
<li>Size: Memory 1G, SSD 25 GB, Transfer 1 TB, Price $5/mo</li>
<li>Datacenter Region: San Fransisco 2</li>
<li>Additional Options: None</li>
<li>SSH keys: <strong>Added all of <a href="/ssh-keys-with-putty.html">my saved SSH keys</a>. You need this to log into the server with PuTTY</strong></li>
</ul>
<p>Create the server with the big green <strong>Create</strong> button.</p>
<p>After the Droplet is created, note the IP address of the server. You'll need the IP address of the droplet for the next step.</p>
<h3 id="login-to-server-with-putty">Login to Server with PuTTY</h3>
<p>Our first interaction with the server is to log in as root. Then we'll create a non-root sudo user to interact with the server from here on out.</p>
<p>Open PuTTY and log onto the server as root. See a <a href="/new-digital-ocean-droplet.html">previous post</a> on how to set up PuTTY to log in as root. To log into the server as root, set the following in PuTYY:</p>
<ul>
<li>Hostname (or IP Address): The IP address of the server</li>
<li>Port: 22</li>
<li>Connection Type: SSH</li>
<li>Connection:</li>
<li>Data:<ul>
<li>Auto-login username: root</li>
</ul>
</li>
<li>Connection:</li>
<li>SSH:<ul>
<li>Auth:</li>
<li>Private keyfile for Authentication: your saved private SSH key</li>
</ul>
</li>
</ul>
<p><img alt="PuTTY IP Address" src="/posts/jupyterhub/puTTY_IP_and_Port.png"></p>
<p><img alt="PuTTY IP Login name" src="/posts/jupyterhub/putty_login_details.png"></p>
<p><img alt="PuTTY IP Login name" src="/posts/jupyterhub/putty_Auth_SSH_private_key.png"></p>
<h3 id="create-a-non-root-sudo-user">Create a non-root sudo user</h3>
<p>I followed along with the <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Digital Ocean Initial Server Setup Tutorial</a> to create a non-root sudo user. The commands to enter into the PuTTY SSH terminal are below. Note that you should change the user name to something other than <code>peter</code>. In the Digital Ocean tutorial, a hash symbol <code>#</code> is shown before these commands. The hash symbol should not be typed, it just represents the fact that you are operating as root.</p>
<div class="highlight"><pre><span></span>adduser peter
usermod -aG sudo peter
ufw allow OpenSSH
ufw <span class="nb">enable</span>
</pre></div>


<h3 id="copy-ssh-keys-to-non-root-sudo-user">Copy SSH keys to non-root sudo user</h3>
<p>Next you'll need to move over the SSH keys stored in the root user's profile to the new sudo user's profile (in my case <code>peter</code>). I've had trouble with setting moving these files and setting the permissions correctly in Linux. The Digital Ocean Tutorial has a great line to more the SSH Keys and set permissions in one step. If you skip this step, you won't be able to log into the server as the new sudo user you just created. Note that you should again change the user name to something other than <code>peter</code>.</p>
<div class="highlight"><pre><span></span>rsync --archive --chown<span class="o">=</span>peter:peter ~/.ssh /home/peter
</pre></div>


<p>Now to check that everything works, exit the PuTTY window by typing <code>exit</code> at the prompt, and open up a new SSH session in PuTTY setting Connection --&gt; Data --&gt; Auto-login username as your non-root sudo user. (I put <code>peter</code> in the Auto-login username box). When the terminal window opens, you should see your username listed before the prompt. At the prompt, try the following command. Note the dollar sign <code>$</code> does not need to be typed, it is there to show the command prompt:</p>
<div class="highlight"><pre><span></span>$ sudo -l
User peter may run the following commands on flask-app-server:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> ALL
</pre></div>


<p>You can type the command <code>exit</code> to close the terminal.</p>
<h2 id="acquire-and-configure-domain-name">Acquire and configure domain name</h2>
<p>To use secure SSL connections and https with the flask single page app, I needed a real domain name.</p>
<h3 id="purchase-a-domain-name">Purchase a domain name</h3>
<p>I bought my domain name at <a href="https://domains.google/">Google Domains</a> for $12/year. The price seems reasonable and Digital Ocean has a tutorial that shows how to connect a google domain's purchased domain name and hook it up to Digital Ocean DNS servers.</p>
<h3 id="point-dns-severs-at-digital-ocean">Point DNS severs at Digital Ocean</h3>
<p>Once the domain is purchased, the domain's DNS record needs to be pointed to Digital Ocean.</p>
<p><img alt="Google Domains DNS Routing" src="/posts/jupyterhub/google_domains_dns_routing.png"></p>
<h3 id="link-the-domain-name-to-the-server-ip-address">Link the domain name to the server IP address</h3>
<p>On Digital Ocean, login and click [Create] --&gt; Domains/DNS. Type in the newly purchased domain name in the box and click [Add Domain]. Then link the new Domain to the new Digital Ocean Droplet by typing an at symbol <code>@</code> in the [HOSTNAME] box and selecting the new Droplet in the [WILL DIRECT TO] dropdown box. Click [Create Record] to link the domain name to the server. You can also link <code>www</code> in the [HOSTNAME] box and select the new Droplet in the [WILL DIRECT TO] dropdown box to link www.yourdomain.com to the Droplet.</p>
<p><img alt="Digital Ocean Domains-DNS" src="/posts/jupyterhub/DO_manage_domains.png"></p>
<h2 id="build-the-flask-app">Build the Flask App</h2>
<p>Now that the server is set up and the domain name is hooked up the the server, it's time to actually build the <strong>flask</strong> single page web app.</p>
<h3 id="install-packages">Install Packages</h3>
<p>Before the single page flask app can be built, a number of packages need to be installed on the server. I followed along with <a href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uswgi-and-nginx-on-ubuntu-18-04">this tutorial</a> from Digital Ocean. Log onto the server with PuTTY and type the following commands.</p>
<div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get upgrade
$ sudo apt install python3-pip python3-dev python3-setuptools python3-venv
$ sudo apt-get install build-essential libssl-dev libffi-dev 
</pre></div>


<h3 id="create-a-virtual-environment-and-install-flask">Create a Virtual Environment and install <strong>flask</strong></h3>
<p>Once the necessary libraries are installed, I created a virtual environment to run the flask app. I usually use <strong>conda</strong> to create virtual environments, but since I'm not using the Anaconda distribution of Python for this <strong>flask</strong> app, <strong>venv</strong> will have to do instead.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~
$ mkdir flaskapp
$ <span class="nb">cd</span> flaskapp
$ python3.6 -m venv flaskappenv
$ <span class="nb">source</span> flaskapp/bin/activate
</pre></div>


<p>With the virtual environment created and activated, I installed flask, wheel, uwsgi and requests with <strong>pip</strong>. Note that <code>(flaskappenv)</code> is shown before the prompt when the virtual environment is active. Make sure to only <code>pip install</code> in the virtual environment.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>flaskappenv<span class="o">)</span>$ pip install wheel
<span class="o">(</span>flaskappenv<span class="o">)</span>$ pip install flask
<span class="o">(</span>flaskappenv<span class="o">)</span>$ pip install uwsgi
<span class="o">(</span>flaskappenv<span class="o">)</span>$ pip install requests
</pre></div>


<h3 id="build-the-first-simple-flask-app">Build the first simple <strong>flask</strong> app</h3>
<p>With the Python packages installed, next I built a very simple version of the <strong>flask</strong> app and viewed it in a web browser.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>flaskappenv<span class="o">)</span>$ <span class="nb">pwd</span>
<span class="c1"># ~/flaskapp</span>
<span class="o">(</span>flaskappenv<span class="o">)</span>$ nano showtemp.py
</pre></div>


<p>In the <strong><em>showtemp.py</em></strong> file,  I included the bare minimum flask app to see if it works:</p>
<div class="highlight"><pre><span></span><span class="c1"># showtemp.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;h1&gt;The temperature is 91.2 F&lt;/h1&gt;&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</pre></div>


<p>You can paste into PuTTY using the right mouse button. Note that [ctrl-x] exits the nano text editor.</p>
<h3 id="testing-the-first-simple-flask-app">Testing the first simple flask app</h3>
<p>With the first version of the <strong><em>showtemp.py</em></strong> file complete, I ran the <strong>flask</strong> app for the first time to see if anything came out.</p>
<p>To run the <strong>flask</strong> app, I had to make sure I was in the virtual environment I built earlier. I also needed to allow port 5000 open, because that is the default port that flask runs on.</p>
<div class="highlight"><pre><span></span>(flaskappenv)$ sudo ufw allow 5000
(flaskappenv)$ python showtemp.py
</pre></div>


<p>It works! By pointing a browser to the droplet IP address followed by <code>:5000</code>, I could see my simple message: "The temperature is 91.2 F".</p>
<h2 id="setting-up-uwsgi-nginx-and-systemctl">Setting up uWSGI, nginx and systemctl</h2>
<h3 id="configuring-uwsgi">Configuring uWSGI</h3>
<p>There are going to be two layers between the flask app and the outside internet. The requests will first come into <strong>NGINX</strong> then go to <strong>uWSGI</strong>. I installed <strong>uWSGI</strong> earlier when I <code>pip</code> installed flask. Now uWSGI needs to be configured and tested:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>flaskappenv<span class="o">)</span>$ <span class="nb">pwd</span>
<span class="c1"># ~/flaskapp</span>
<span class="o">(</span>flaskappenv<span class="o">)</span>$ nano wsgi.py
</pre></div>


<p>In the <strong><em>wsgi.py</em></strong> file, I included:</p>
<div class="highlight"><pre><span></span><span class="c1"># wsgi.py</span>

<span class="kn">from</span> <span class="nn">showtemp</span> <span class="kn">import</span> <span class="n">app</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h3 id="testing-uwsgi">Testing uWSGI</h3>
<p>Next I tested the configuration. uWSGI can be run from the command line with a couple flags:</p>
<div class="highlight"><pre><span></span>flaskappenv<span class="o">)</span>$ uwsgi --socket <span class="m">0</span>.0.0.0:5000 --protocol<span class="o">=</span>http -w wsgi:app
</pre></div>


<p>Still seems to be working! By pointing a browser to the droplet IP address followed by <code>:5000</code>, I could still see The simple message: "The temperature is 91.2 F".</p>
<h3 id="making-a-uwsgi-configuration-file">Making a uWSGI configuration file</h3>
<p>Now for another layer of uWSGI goodness- building a uWSGI <strong><em>.ini</em></strong> configuration file</p>
<div class="highlight"><pre><span></span><span class="o">(</span>flaskappenv<span class="o">)</span>$ deactivate
$ <span class="nb">pwd</span>
<span class="c1"># ~/flaskapp</span>
$ nano flaskapp.ini
</pre></div>


<p>Inside the <strong><em>flaskapp.ini</em></strong> file I included the followingL</p>
<div class="highlight"><pre><span></span>[uwsgi]
module = wsgi:app

master = true
processes = 5

socket = myproject.sock
chmod-socket = 660
vacuum = true

die-on-term = true
</pre></div>


<h3 id="making-a-systemd-file">Making a systemd file</h3>
<p>Because I want to have the flask app running all the time, I created a <strong>systemd</strong> control file to get the flask app running as a system service.</p>
<div class="highlight"><pre><span></span>$ sudo nano /etc/systemd/system/flaskapp.service
</pre></div>


<p>In the <strong><em>flaskapp.service</em></strong> file, I included the following. Note that the username <code>peter</code> should be replaced with your non-root sudo user.</p>
<div class="highlight"><pre><span></span>[Unit]
Description=uWSGI instance to serve myproject
After=network.target

[Service]
User=sammy
Group=www-data
WorkingDirectory=/home/peter/flaskapp
Environment=&quot;PATH=/home/peter/flaskapp/flaskappenv/bin&quot;
ExecStart=/home/peter/flaskapp/flaskappenv/bin/uwsgi --ini flaskapp.ini

[Install]
WantedBy=multi-user.target
</pre></div>


<h3 id="test-with-systemctl">Test with systemctl</h3>
<p>After the <strong><em>flaskapp.service</em></strong> file is complete and saved, we can test our service using:</p>
<div class="highlight"><pre><span></span>$ sudo systemctl start myproject
$ sudo systemctl status myproject
</pre></div>


<p>The <code>status</code> call should show the service as <code>active (running)</code>. Use [ctrl]-[c] to exit the status screen. This will not stop the service.</p>
<p>After pointing a web browser to the droplet IP address followed by <code>:5000</code>, I could still see The simple message: "The temperature is 91.2 F". Looks like the <strong>NGINX</strong>-<strong>uWSGI</strong>-<strong>flask</strong> stack is working properly.</p>
<h2 id="add-bootstrap-styling">Add Bootstrap Styling</h2>
<h2 id="pull-the-temperature-with-requests">Pull the temperature with <strong>requests</strong></h2>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="/micropython-upload-code.html">Upload Micropython Code to an Adafruit Feather Huzzah ESP8266</a></li>
        <li><a href="/micropython-wifi.html">Using Micropython to connect an Adafruit Feather Huzzah ESP8266 to WiFi</a></li>
        <li><a href="/assignments-dir-and-custom-login-page-to-jupyterhub.html">Add a custom login page and assignments directory for each user on a Jupyter Hub server</a></li>
        <li><a href="/add-google-oauth-and-system-service-to-jupyterhub.html">Adding Google OAuth and system service to a Jupyter Hub server</a></li>
        <li><a href="/add-ssl-and-domain-name-to-jupyterhub.html">Adding SSL and a domain name to Jupyter Hub</a></li>
    </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="/extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, MATLAB and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="/micropython-upload-code.html">Upload Micropython Code to an Adafruit Feather Huzzah ESP8266</a></li>
    <li class="list-group-item"><a href="/micropython-wifi.html">Using Micropython to connect an Adafruit Feather Huzzah ESP8266 to WiFi</a></li>
    <li class="list-group-item"><a href="/assignments-dir-and-custom-login-page-to-jupyterhub.html">Add a custom login page and assignments directory for each user on a Jupyter Hub server</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-3">
      <a href="/tag/blog.html">blog</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/esp8266.html">esp8266</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/jupyter-hub.html">jupyter hub</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/jupyter-notebooks.html">jupyter notebooks</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="/tag/python.html">python</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <script src="/static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
</body>
</html>