<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Building an IoT Server with flask and Python - Part 6 - upload code to ESP8266-based WiFi weather stations - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

    /*some stuff for output/input prompts*/
    div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
    div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
    div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
    div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
    @media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
    div.prompt:empty{padding-top:0;padding-bottom:0}
    div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
    div.inner_cell{width:90%;}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
    div.input_prompt{color:navy;border-top:1px solid transparent;}
    div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
    div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
    div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
    div.output_prompt{color:darkred;}
    
    a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
    h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
    /* end stuff for output/input prompts*/
    
    
    .highlight-ipynb .hll { background-color: #ffffcc }
    .highlight-ipynb  { background: #f8f8f8; }
    .highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
    .highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
    .highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
    .highlight-ipynb .o { color: #666666 } /* Operator */
    .highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
    .highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
    .highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
    .highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
    .highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
    .highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
    .highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
    .highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
    .highlight-ipynb .go { color: #888888 } /* Generic.Output */
    .highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
    .highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
    .highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
    .highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
    .highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
    .highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
    .highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
    .highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
    .highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
    .highlight-ipynb .m { color: #666666 } /* Literal.Number */
    .highlight-ipynb .s { color: #BA2121 } /* Literal.String */
    .highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
    .highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
    .highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
    .highlight-ipynb .no { color: #880000 } /* Name.Constant */
    .highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
    .highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
    .highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
    .highlight-ipynb .nf { color: #0000FF } /* Name.Function */
    .highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
    .highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
    .highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
    .highlight-ipynb .nv { color: #19177C } /* Name.Variable */
    .highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
    .highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
    .highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
    .highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
    .highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
    .highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
    .highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
    .highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
    .highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
    .highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
    .highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
    .highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
    .highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
    .highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
    .highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
    .highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
    .highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
    .highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
    .highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
    .highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
    .highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
    .highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
    
    <style type="text/css">
    /* Overrides of notebook CSS for static HTML export */
    div.entry-content {
      overflow: visible;
      padding: 8px;
    }
    .input_area {
      padding: 0.2em;
    }
    
    a.heading-anchor {
     white-space: normal;
    }
    
    .rendered_html
    code {
     font-size: .8em;
    }
    
    pre.ipynb {
      color: black;
      background: #f7f7f7;
      border: none;
      box-shadow: none;
      margin-bottom: 0;
      padding: 0;
      margin: 0px;
      font-size: 13px;
    }
    
    /* remove the prompt div from text cells */
    div.text_cell .prompt {
        display: none;
    }
    
    /* remove horizontal padding from text cells, */
    /* so it aligns with outer body text */
    div.text_cell_render {
        padding: 0.5em 0em;
    }
    
    img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
    
    div.collapseheader {
        width=100%;
        padding: 2px;
        cursor: pointer;
        font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
    }
    
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
    <script type="text/javascript">
    init_mathjax = function() {
        if (window.MathJax) {
            // MathJax loaded
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                },
                displayAlign: 'center', // Change this to 'center' to center equations.
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 0}}
                }
            });
            MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    
    <link href="./extra/favicon.ico" rel="icon">

<link rel="canonical" href="./flask-iot-server-upload-code-to-esp8266.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="python,flask,IoT,sensor" />
        <meta name="description" content="This is the sixth part of a series of posts about building an Internet of Things (IoT) server with flask, Python and ESP8266 microcontrollers. In this post, we&#39;ll add some code to our ESP8266-based weather stations. The code we upload to the ESP8266 microcontrollers programs the WiFi weather stations to …" />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Building an IoT Server with flask and Python - Part 6 - upload code to ESP8266-based WiFi weather stations"/>
        <meta property="og:url" content="./flask-iot-server-upload-code-to-esp8266.html"/>
        <meta property="og:description" content="This is the sixth part of a series of posts about building an Internet of Things (IoT) server with flask, Python and ESP8266 microcontrollers. In this post, we&#39;ll add some code to our ESP8266-based weather stations. The code we upload to the ESP8266 microcontrollers programs the WiFi weather stations to …"/>
        <meta property="article:published_time" content="2018-09-19" />
            <meta property="article:section" content="flask" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="flask" />
            <meta property="article:tag" content="IoT" />
            <meta property="article:tag" content="sensor" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/native.css" rel="stylesheet">
    <link href="./theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./static/css/custom.css" rel="stylesheet">



</head>
<body>

<!-- .navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/about.html">
                             About
                          </a></li>
                         <li><a href="./pages/book.html">
                             Book
                          </a></li>
                         <li><a href="./pages/gear.html">
                             Gear
                          </a></li>
                         <li><a href="./pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">

<!-- .navbar-search -->
<li>
    <span>
        <form class="navbar-search" action="/search.html">
            <input type="text" name="q" id="tipue_search_input">
        </form>
    </span>
</li>
<!-- /.navbar-search -->              <li><a href="./archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="." title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="./category/flask.html" title="flask">flask</a></li>
                <li class="active">Building an IoT Server with flask and Python - Part 6 - upload code to ESP8266-based WiFi weather stations</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./flask-iot-server-upload-code-to-esp8266.html"
                       rel="bookmark"
                       title="Permalink to Building an IoT Server with flask and Python - Part 6 - upload code to ESP8266-based WiFi weather stations">
                        Building an IoT Server with flask and Python - Part 6 - upload code to ESP8266-based WiFi weather stations
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-09-19T09:01:00-07:00"> Wed 19 September 2018</time>
    </span>

            <span class="label label-default">Series</span>
            Part 6 of Building an IoT Server with Flask and Python




<span class="label label-default">Tags</span>
	<a href="./tag/python.html">python</a>
        /
	<a href="./tag/flask.html">flask</a>
        /
	<a href="./tag/iot.html">IoT</a>
        /
	<a href="./tag/sensor.html">sensor</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><img alt="ESP8266 with sensor" src="./posts/flask/esp8266-based_wifi_weather_station.png"></p>
<p>This is the sixth part of a series of posts about building an Internet of Things (IoT) server with <strong>flask</strong>, Python and ESP8266 microcontrollers. In this post, we'll add some code to our ESP8266-based weather stations. The code we upload to the ESP8266 microcontrollers programs the WiFi weather stations to measure the temperature. After the ESP8266-based weather stations measure the temperature, the microcontroller executes a GET request to our <strong>flask</strong> IoT server web API.</p>
<div class="toc"><span class="toctitle">Table of contents:</span><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#hardware-setup">Hardware Setup</a></li>
<li><a href="#upload-firmware">Upload firmware</a><ul>
<li><a href="#download-the-latest-micropython-firmware-bin-file">Download the latest Micropython firmware .bin file</a></li>
<li><a href="#install-the-silabs-driver-for-the-adafruit-feather-huzzah-esp8266">Install the SiLabs driver for the Adafruit Feather Huzzah ESP8266</a></li>
<li><a href="#connect-the-adafruit-feather-huzzah-esp8266-board-to-the-laptop">Connect the Adafruit Feather Huzzah ESP8266 board to the laptop</a></li>
<li><a href="#determine-which-serial-port-the-feather-huzzah-is-connected-to">Determine which serial port the Feather Huzzah is connected to</a></li>
<li><a href="#run-esptool-to-upload-the-bin-file-to-the-feather-huzzah">Run esptool to upload the .bin file to the Feather Huzzah</a></li>
</ul>
</li>
<li><a href="#construct-py-files">Construct .py files</a></li>
<li><a href="#upload-py-files">Upload .py files</a></li>
<li><a href="#test-esp8266-based-weather-stations">Test ESP8266-based weather stations</a></li>
<li><a href="#upload-mainpy">Upload main.py</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>
<h2 id="introduction">Introduction</h2>
<p>In the last post, we added a database to our <strong>flask</strong> IoT server. Each time our <strong>flask</strong> IoT server web API is hit with a valid URL, the data contained in the URL is saved as a record in a sqlite3 database on the server. Each time we browse to the main page of the <strong>flask</strong> IoT server site, we see the most recent temperature posted. The posted temperature is pulled from the sqlite3 database. </p>
<p>In this post, we are going to create a couple new <strong><em>.py</em></strong> files and upload the <strong><em>.py</em></strong> files to the ESP8266-based WiFi weather stations. These <strong><em>.py</em></strong> files enable the ESP8266-based WiFi weather stations to measure the temperature, then post the temperature to our <strong>flask</strong> IoT server.</p>
<h2 id="hardware-setup">Hardware Setup</h2>
<p>Before we upload any new code to the ESP8266-based weather stations, let's review the hardware setup. Below is a schematic of the ESP8266-based weather stations. The schematic shows an ESP8266 microcontroller (an <a href="https://www.adafruit.com/product/2821">Adafruit Feather Huzzah ESP8266</a>) connected to a temperature sensor (<a href="https://www.adafruit.com/product/1782">MCP9808</a>) with jumper wires.</p>
<p><img alt="fritzing sketch" src="./posts/micropython/feather_huzzah_temp_sensor_fritzing.png"></p>
<h2 id="upload-firmware">Upload firmware</h2>
<p>If you are following along with this series, you might remember the ESP8266-based WiFi weather station hardware and software setup in the <a href="./posts/flask/flask_IoT_server_part1_motivation.md">first post of the series</a>. In case the Feather Huzzah ESP8266 microcontroller doesn't have an up-to-date version of Micropython on it, below are instructions detailing how to upload the Micropython firmware to the board.</p>
<h3 id="download-the-latest-micropython-firmware-bin-file">Download the latest Micropython firmware .bin file</h3>
<p>Go to GitHub and <a href="https://micropython.org/download#esp8266">download the latest .bin firmware</a> file. Move the <strong><em>.bin</em></strong> firmware file to a new <strong>micropython</strong> directory. The <strong><em>.bin</em></strong> firmware file is the version of Micropython that runs on the Adafruit Feather Huzzah ESP8266. </p>
<p><img alt=".bin firmware on github" src="./posts/micropython/firmware_download_page.PNG"></p>
<h3 id="install-the-silabs-driver-for-the-adafruit-feather-huzzah-esp8266">Install the SiLabs driver for the Adafruit Feather Huzzah ESP8266</h3>
<p>Before we can connect the Adafruit Feather Huzzah to the computer, we need a specific driver installed. For my Windows 10 laptop to see the Adafruit Feather Huzzah board, the <a href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers">CP210x USB to UART Bridge VCP driver</a> needs to be downloaded from SiLabs and installed.</p>
<p><img alt="SiLabs Driver" src="./posts/micropython/download_silabs_driver.PNG"></p>
<h3 id="connect-the-adafruit-feather-huzzah-esp8266-board-to-the-laptop">Connect the Adafruit Feather Huzzah ESP8266 board to the laptop</h3>
<p>Use a micro-USB cable (the same kind of cable that charges many mobile phones) to connect the Feather Huzzah to the computer. Make sure that the micro-USB cable is a full USB <em>data cable</em> and not just a simple power cable. I had trouble getting the Feather Huzzah to work, and it turned out the reason was my micro-USB cable was only a charging cable. Charge-only cables cannot transfer data. </p>
<h3 id="determine-which-serial-port-the-feather-huzzah-is-connected-to">Determine which serial port the Feather Huzzah is connected to</h3>
<p>Use Windows Device Manager to determine which serial port the Feather Huzzah board is connected to. We'll need the serial port as one of the parameters when we upload the <strong><em>.bin</em></strong> firmware file on the board. Look for something like <strong>Silicon Labs CP210x USB to UART Bridge (COM4)</strong> in the <strong>Ports (COM &amp; LPT)</strong> menu. The USB to UART bridge is the Feather Huzzah ESP8266 microcontroller board. CP210x refers to the chip that handles serial communication on the Feather Huzzah, not the ESP8266 chip itself. Make a note of the number after <strong>(COM )</strong>. It often comes up as <strong>(COM4)</strong> but it may be different on your computer. </p>
<p><img alt="Find Device Manager" src="./posts/micropython/find_device_manager.png"></p>
<p><img alt="Device Manager Menu" src="./posts/micropython/device_manager_menu.png"></p>
<h3 id="run-esptool-to-upload-the-bin-file-to-the-feather-huzzah">Run esptool to upload the .bin file to the Feather Huzzah</h3>
<p>On a local computer (not the server), open the Anaconda Prompt or a terminal and <code>cd</code> into the directory with the <strong><em>.bin</em></strong> firmware file. The <strong><em>.bin</em></strong> firmware file is called something like <code>esp8266-20171101-v1.9.3.bin</code>. Create and activate a new conda virtual environment and install <strong>esptool</strong> into the environment.</p>
<div class="highlight"><pre><span></span>&gt; conda create -n micropython python=3.7
&gt; conda activate micropython
&gt; (micropython) pip install esptool
</pre></div>


<p>Before we write the <strong><em>.bin</em></strong> firmware file to the ESP8266, we'll first erase the flash memory on the little microcontroller using the <code>esptool erase_flash</code> command. Make sure to specify the <code>--port</code> you found in the Windows Device Manager.  In my case the port was <code>COM4</code>.</p>
<div class="highlight"><pre><span></span>&gt; (micropython) esptool --port COM4 erase_flash
</pre></div>


<p><img alt="esptool erase flash" src="./posts/micropython/esptool_erase_flash.PNG"></p>
<p>Now it's time to write the <strong><em>.bin</em></strong> firmware file to the flash memory on the ESP8266 board using the <code>esptool write_flash</code> command. Make sure to use the exact <strong><em>.bin</em></strong> firmware file name. The <strong><em>.bin</em></strong> firmare filename is easy to mistype. <code>--port</code> has to be set as the port you found in the Windows Device Manager. <code>---baud</code> is the baud rate (upload speed). I found that <code>--baud 460800</code> worked, but you could also specify <code>--baud 115200</code>, which is slower. The upload time was a matter of seconds with either baud rate. The <code>0</code> after <code>--flash_size=detect</code> means we want the firmware written at the start of the flash memory (the 0<sup>th</sup> position) on the board. </p>
<p>An issue I ran into was that I tried to use the command <code>esptool.py</code> instead of <code>esptool</code> as shown on the <a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html#deploying-the-firmware">Micropython docs</a>. The documentation for <a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html#deploying-the-firmware">Micropython on the ESP8266</a> specifies the command <code>esptool.py</code> (including the <strong>.py</strong> file extension). The command <code>esptool.py</code> did work on my Windows 10 machine. Omitting the <strong>.py</strong> file extension, and running <code>esptool</code> worked instead. </p>
<div class="highlight"><pre><span></span>&gt; (micropython) esptool --port COM4 --baud 460800 write_flash --flash_size=detect 0 esp8266-20171101-v1.9.3.bin
</pre></div>


<p><img alt="esptool write flash" src="./posts/micropython/esptool_write_flash.PNG"></p>
<h2 id="construct-py-files">Construct <strong><em>.py</em></strong> files</h2>
<p>Now that Micropython is loaded on the ESP8266 microcontroller, we'll construct a couple of <strong><em>.py</em></strong> files to load onto the board. </p>
<p>The first file is <strong><em>wifitools.py</em></strong>. This module contains a couple of helper functions that allow the ESP8266 to connect to a WiFi network and make GET requests.</p>
<div class="highlight"><pre><span></span><span class="c1"># wifitools.py</span>

<span class="kn">import</span> <span class="nn">urequests</span>

<span class="c1">#https://docs.micropython.org/en/v1.8.6/esp8266/esp8266/tutorial/network_basics.html</span>
<span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">SSID</span><span class="p">,</span><span class="n">password</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">network</span>
    <span class="n">sta_if</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sta_if</span><span class="o">.</span><span class="n">isconnected</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;connecting to network...&#39;</span><span class="p">)</span>
        <span class="n">sta_if</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sta_if</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">sta_if</span><span class="o">.</span><span class="n">isconnected</span><span class="p">():</span>
            <span class="k">pass</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;network config:&#39;</span><span class="p">,</span> <span class="n">sta_if</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">getmac</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">network</span>
    <span class="kn">import</span> <span class="nn">ubinascii</span>
    <span class="k">return</span> <span class="n">ubinascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">()</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">flaskiot_post</span><span class="p">(</span><span class="n">API_key</span><span class="p">,</span><span class="n">mac_address</span><span class="p">,</span><span class="n">field</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="c1"># https://freetemp.org/update/API_key=ASCIISTR/mac=6c:rf:7f:2b:0e:g8/field=1/data=72.3</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://freetemp.org/update&#39;</span>
    <span class="n">api_key_url</span> <span class="o">=</span> <span class="s1">&#39;/API_key=&#39;</span> <span class="o">+</span> <span class="n">API_key</span>
    <span class="n">mac_url</span> <span class="o">=</span> <span class="s1">&#39;/mac=&#39;</span> <span class="o">+</span> <span class="n">mac_address</span>
    <span class="n">field_url</span> <span class="o">=</span> <span class="s1">&#39;/field=&#39;</span> <span class="o">+</span> <span class="n">field</span>
    <span class="n">data_url</span> <span class="o">=</span> <span class="s1">&#39;/data=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">api_key_url</span> <span class="o">+</span> <span class="n">mac_url</span> <span class="o">+</span> <span class="n">field_url</span> <span class="o">+</span> <span class="n">data_url</span>
    <span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urequests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>


<p>The second file <strong><em>MCP9808.py</em></strong>, contains a function to read the temperature off of the MCP9808 temperature sensor. </p>
<div class="highlight"><pre><span></span><span class="c1"># MCP9808.py</span>

<span class="c1"># Functions for the  MCP9808 temperature sensor</span>
<span class="c1"># https://learn.adafruit.com/micropython-hardware-i2c-devices/i2c-master</span>

<span class="k">def</span> <span class="nf">readtemp</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">machine</span>
    <span class="n">i2c</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="n">scl</span><span class="o">=</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">sda</span><span class="o">=</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">byte_data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">i2c</span><span class="o">.</span><span class="n">readfrom_mem_into</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">byte_data</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">byte_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">byte_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.0</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x1000</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">-=</span> <span class="mf">256.0</span>
    <span class="k">return</span> <span class="n">temp</span>
</pre></div>


<p>The third file, <strong><em>config.py</em></strong>, contains the API key and mac address the ESP8266 uses in the GET requests to send a valid URL to our flask IoT server. <strong><em>config.py</em></strong> also contains the SSID and WiFi password of the wireless network. The constants <code>API_key</code> and <code>mac</code> should be set to the values used in the server script <code>flaskapp.py</code>. Make sure to add this file to <strong><em>.gitignore</em></strong> to keep it out of version control.</p>
<div class="highlight"><pre><span></span><span class="c1"># config.py</span>

<span class="c1"># API keys, passwords, mac address</span>
<span class="c1"># keep out of version control</span>

<span class="c1">#api_key = config.API_KEY</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s1">&#39;TGS894F&#39;</span>

<span class="c1">#ssid = config.SSID</span>
<span class="n">SSID</span> <span class="o">=</span> <span class="s1">&#39;My WiFi Network&#39;</span>

<span class="c1">#password = config.WIFI_PASSWORD</span>
<span class="n">WIFI_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;my_wifi_password&#39;</span>

<span class="n">MAC_ADDRESS</span> <span class="o">=</span> <span class="s1">&#39;6c:ef:7r:3b:9d:e8&#39;</span>
</pre></div>


<p>The fourth file - <strong><em>run.py</em></strong>, is a script with one primary function. The function programs the ESP8266 to:</p>
<ul>
<li>connect to the WiFi network</li>
<li>read the temperature off of the MCP9808 temperature sensor</li>
<li>try to post the temperature to our flask IoT server</li>
<li>wait 1 minute</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># run.py</span>

<span class="c1"># ESP8266 Feather Huzzah Weather Station, connected to flask IoT server</span>

<span class="kn">import</span> <span class="nn">wifitools</span>
<span class="kn">import</span> <span class="nn">MCP9808</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">config</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ssid</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SSID</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">WIFI_PASSWORD</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">API_KEY</span>
    <span class="n">mac_address</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">MAC_ADDRESS</span>
    <span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>

    <span class="n">wifitools</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">MCP9808</span><span class="o">.</span><span class="n">readtemp</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wifitools</span><span class="o">.</span><span class="n">flaskiot_post</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span><span class="n">mac_address</span><span class="p">,</span><span class="n">field</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>


<h2 id="upload-py-files">Upload <strong><em>.py</em></strong> files</h2>
<p>We'll use a tool called <strong>ampy</strong> to upload the <strong><em>.py</em></strong> files to the board. Make sure <strong>ampy</strong> is installed in the virtual environment you're using.</p>
<div class="highlight"><pre><span></span>&gt; conda activate micropython
&gt; (micropython) pip install ampy
</pre></div>


<p>To upload the <strong><em>.py</em></strong> files, make sure the board is plugged into the computer with a USB data cable and use the <strong>ampy</strong> <code>put</code> command. Note the <code>--port</code> is specified.</p>
<div class="highlight"><pre><span></span>&gt; (micropython)$ ampy --port COM4 put MCP9808.py
&gt; (micropython)$ ampy --port COM4 put wifitools.py

&gt; (micropython)$ ampy --port COM4 put config.py
&gt; (micropython)$ ampy --port COM4 put run.py
&gt; (micropython)$ ampy --port COM4 ls
&gt; boot.py
wifitools.py
MCP9808.py
config.py
run.py
</pre></div>


<h2 id="test-esp8266-based-weather-stations">Test ESP8266-based weather stations</h2>
<p>Connect the ESP8266 to the local computer with a micro-USB cable. Use PuTTY to open up the Micropython REPL and try to run the main script in <strong><em>run.py</em></strong></p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; import run
&gt;&gt;&gt; run.main()
</pre></div>


<p>The temperature is measured once a minute and posted to our flask IoT server. Open up a web browser to the server's main page and view the most recent data point.</p>
<blockquote>
<p>https://mydomain.com</p>
</blockquote>
<p><img alt="show recent datapoint" src="./posts/flask/showrecent.png"></p>
<h2 id="upload-mainpy">Upload <strong><em>main.py</em></strong></h2>
<p>Now that we know our ESP8266-based WiFi weather stations are working correctly, we'll upload a <strong><em>main.py</em></strong> file to the board and start recording temperatures and sending the temperature to our flask IoT server web API.</p>
<p>The <strong><em>main.py</em></strong> script runs automatically when the ESP8266 is powered up. The simple script contains an import and a line of code to run the <code>main()</code> function in <strong><em>run.py</em></strong>.</p>
<div class="highlight"><pre><span></span><span class="c1"># main.py</span>

<span class="c1"># runs after boot.py</span>

<span class="kn">import</span> <span class="nn">run</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">run</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;main() function in run.py could not be executed&quot;</span><span class="p">)</span>
</pre></div>


<p>After the <strong><em>main.py</em></strong> script is constructed, upload it onto the ESP8266 with <strong>ampy</strong>.</p>
<div class="highlight"><pre><span></span>&gt; (micropython) ampy --port COM4 put main.py
&gt; (micropython) ampy --port COM4 ls
wifitools.py
MCP9808.py
config.py
main.py
run.py
</pre></div>


<p>Now for the big payoff. Plug the ESP8266 into power, but disconnected from the local computer. Go to the main page on the flask-IoT server and see the temperature measured once a minute.</p>
<blockquote>
<p>https:mydomain.com</p>
</blockquote>
<h2 id="summary">Summary</h2>
<p>It works! We have a working Internet of Things (IoT) server that has a working web API that ESP8266-based WiFi weather stations can post to. Building the flask IoT server was a big project. It is great to have a set of WiFi weather stations that post the temperature to a server. I can view the temperature on my phone from anywhere with a cell phone connection. The ESP8266-based WiFi weather stations can be plugged in anywhere with power (or run on a battery) within my WiFi network. Using two of the stations, I can see the temperature outside the house and the temperature inside the house from anywhere.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="./flask-iot-server-database.html">Building an IoT Server with flask and Python - Part 5 Adding a Database</a></li>
        <li><a href="./flask-iot-server-validation-time-stamps.html">Building an IoT Server with flask and Python - Part 4 Validation and Timestamps</a></li>
        <li><a href="./flask-iot-server-web-API.html">Building an IoT Server with flask and Python - Part 3 Web API</a></li>
        <li><a href="./flask-iot-server-setup.html">Building an IoT Server with flask and Python - Part 2 Set Up</a></li>
        <li><a href="./flask-iot-server-motivation.html">Building an IoT Server with Flask and Python - Part 1 Motivation</a></li>
    </ul>
</section>
<section class="well" id="related-posts">
    <h4>Article 6 of the Building an IoT Server with Flask and Python series</h4>
       <h5>Previous articles</h5>
       <ul>
           <li><a href="./flask-iot-server-motivation.html">Building an IoT Server with Flask and Python - Part 1 Motivation</a></li>
           <li><a href="./flask-iot-server-setup.html">Building an IoT Server with flask and Python - Part 2 Set Up</a></li>
           <li><a href="./flask-iot-server-web-API.html">Building an IoT Server with flask and Python - Part 3 Web API</a></li>
           <li><a href="./flask-iot-server-validation-time-stamps.html">Building an IoT Server with flask and Python - Part 4 Validation and Timestamps</a></li>
           <li><a href="./flask-iot-server-database.html">Building an IoT Server with flask and Python - Part 5 Adding a Database</a></li>
       </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
    </div>
    <!-- AddThis Button END -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Ethical Ads -->
<div class="horizontal" data-ea-publisher="pythonforundergradengineers-com" data-ea-type="image"></div>
<!-- end Ethical Ads --><div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="./extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="./exponents-and-logs-with-python.html">Exponents and Logs with Python</a></li>
    <li class="list-group-item"><a href="./how-to-do-trig-with-Python.html">How to do Trig with Python</a></li>
    <li class="list-group-item"><a href="./how-to-do-math-with-Python.html">How to do Math with Python</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="./"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-2">
      <a href="./tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/flask.html">flask</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/jupyter-notebook.html">jupyter notebook</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/matplotlib.html">matplotlib</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/sensor.html">sensor</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Series -->
<li class="list-group-item">
  <h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Series</span></h4>
  <ul class="list-group">
    <li class="list-group-item">
      <h5></i>Previous article</h5>
      <a href="./flask-iot-server-database.html">Building an IoT Server with flask and Python - Part 5 Adding a Database</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Series -->


<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2022 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <script src="./static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = './theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="./theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
<!-- Ethical Ads JS-->
<script async src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
<!-- end Ethical Ads JS -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cdd8eb4e16bf94c"></script>
</body>
</html>