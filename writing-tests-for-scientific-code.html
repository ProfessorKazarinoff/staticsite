<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Writing Tests for Scientific Code - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

    /*some stuff for output/input prompts*/
    div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
    div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
    div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
    div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
    @media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
    div.prompt:empty{padding-top:0;padding-bottom:0}
    div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
    div.inner_cell{width:90%;}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
    div.input_prompt{color:navy;border-top:1px solid transparent;}
    div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
    div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
    div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
    div.output_prompt{color:darkred;}
    
    a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
    h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
    /* end stuff for output/input prompts*/
    
    
    .highlight-ipynb .hll { background-color: #ffffcc }
    .highlight-ipynb  { background: #f8f8f8; }
    .highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
    .highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
    .highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
    .highlight-ipynb .o { color: #666666 } /* Operator */
    .highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
    .highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
    .highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
    .highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
    .highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
    .highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
    .highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
    .highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
    .highlight-ipynb .go { color: #888888 } /* Generic.Output */
    .highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
    .highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
    .highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
    .highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
    .highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
    .highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
    .highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
    .highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
    .highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
    .highlight-ipynb .m { color: #666666 } /* Literal.Number */
    .highlight-ipynb .s { color: #BA2121 } /* Literal.String */
    .highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
    .highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
    .highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
    .highlight-ipynb .no { color: #880000 } /* Name.Constant */
    .highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
    .highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
    .highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
    .highlight-ipynb .nf { color: #0000FF } /* Name.Function */
    .highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
    .highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
    .highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
    .highlight-ipynb .nv { color: #19177C } /* Name.Variable */
    .highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
    .highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
    .highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
    .highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
    .highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
    .highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
    .highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
    .highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
    .highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
    .highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
    .highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
    .highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
    .highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
    .highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
    .highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
    .highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
    .highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
    .highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
    .highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
    .highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
    .highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
    .highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
    
    <style type="text/css">
    /* Overrides of notebook CSS for static HTML export */
    div.entry-content {
      overflow: visible;
      padding: 8px;
    }
    .input_area {
      padding: 0.2em;
    }
    
    a.heading-anchor {
     white-space: normal;
    }
    
    .rendered_html
    code {
     font-size: .8em;
    }
    
    pre.ipynb {
      color: black;
      background: #f7f7f7;
      border: none;
      box-shadow: none;
      margin-bottom: 0;
      padding: 0;
      margin: 0px;
      font-size: 13px;
    }
    
    /* remove the prompt div from text cells */
    div.text_cell .prompt {
        display: none;
    }
    
    /* remove horizontal padding from text cells, */
    /* so it aligns with outer body text */
    div.text_cell_render {
        padding: 0.5em 0em;
    }
    
    img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
    
    div.collapseheader {
        width=100%;
        padding: 2px;
        cursor: pointer;
        font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
    }
    
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
    <script type="text/javascript">
    init_mathjax = function() {
        if (window.MathJax) {
            // MathJax loaded
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                },
                displayAlign: 'center', // Change this to 'center' to center equations.
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 0}}
                }
            });
            MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    
    <link href="./extra/favicon.ico" rel="icon">

<link rel="canonical" href="./writing-tests-for-scientific-code.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="engineering,testing" />
        <meta name="description" content="In a previous blog post, I wrote about how to incorporate a few software design principals into the code written by scientists. This post is a follow up on one specific software design principle that can be used by scientists: testing Below are some practical ideas about how to incorporate …" />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Writing Tests for Scientific Code"/>
        <meta property="og:url" content="./writing-tests-for-scientific-code.html"/>
        <meta property="og:description" content="In a previous blog post, I wrote about how to incorporate a few software design principals into the code written by scientists. This post is a follow up on one specific software design principle that can be used by scientists: testing Below are some practical ideas about how to incorporate …"/>
        <meta property="article:published_time" content="2021-02-25" />
            <meta property="article:section" content="Python" />
            <meta property="article:tag" content="engineering" />
            <meta property="article:tag" content="testing" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/native.css" rel="stylesheet">
    <link href="./theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./static/css/custom.css" rel="stylesheet">



</head>
<body>

<!-- .navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/about.html">
                             About
                          </a></li>
                         <li><a href="./pages/book.html">
                             Book
                          </a></li>
                         <li><a href="./pages/gear.html">
                             Gear
                          </a></li>
                         <li><a href="./pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">

<!-- .navbar-search -->
<li>
    <span>
        <form class="navbar-search" action="/search.html">
            <input type="text" name="q" id="tipue_search_input">
        </form>
    </span>
</li>
<!-- /.navbar-search -->              <li><a href="./archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="." title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="./category/python.html" title="Python">Python</a></li>
                <li class="active">Writing Tests for Scientific Code</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./writing-tests-for-scientific-code.html"
                       rel="bookmark"
                       title="Permalink to Writing Tests for Scientific Code">
                        Writing Tests for Scientific Code
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2021-02-25T08:11:00-08:00"> Thu 25 February 2021</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="./tag/engineering.html">engineering</a>
        /
	<a href="./tag/testing.html">testing</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><a href="./writing-tests-for-scientific-code.html"><img alt="science lab" src="./posts/testing_science_code/images/lab.jpg"></a></p>
<p>In a <a href="./thoughts-on-software-design-in-scientific-code.html">previous blog post</a>, I wrote about how to incorporate a few software design principals into the code written by scientists. This post is a follow up on one specific software design principle that can be used by scientists: <strong>testing</strong></p>
<p>Below are some practical ideas about how to incorporate software tests into code written by scientists for data analysis and plotting. Keep in mind the steps and tests below don't correspond to every piece of scientific code. My ideas are not designed to revolutionize the ways scientists write code, or fix reproducibility problems in published scientific research, or be a strict TDD (Test-Driven Development) framework for scientific code. The ideas below are some things I came up with that I wanted to share. I hope this post is helpful and starts a few conversations about testing in scientific software.</p>
<p><strong>OK - with that disclaimer out of the way, let's get started.</strong></p>
<h3 id="a-sample-notebook">A sample notebook</h3>
<p>The example scientific code we will be working with in this post is made up of one long script. In the rest of this post, we are going to work on adding tests to this scientific script.</p>
<p>Very often, scientific code includes a couple of common steps:</p>
<ul>
<li>Read in data</li>
<li>Clean or reorganize data</li>
<li>Run calculations on the data</li>
<li>Create a figure or plot</li>
</ul>
<p>Below is a sample Jupyter notebook (that we'll use in the rest of this post) with Python code that reads in a .csv file of data, cleans up the data, runs a calculation, then produces a plot. The data in this example is from a mechanical test frame (a piece of equipment that tests the strength of materials), but the same testing ideas in this post could be applied to a script that analyzes data in another subject area. You can find the Jupyter notebook here: <a href="https://github.com/ProfessorKazarinoff/testing-scientific-code/blob/master/analysis.ipynb">analysis.ipynb</a> and the raw data here: <a href="https://github.com/ProfessorKazarinoff/testing-scientific-code/blob/master/data/raw_data.csv">raw_data.csv</a></p>
<div class="highlight"><pre><span></span><span class="c1"># analysis.ipynb</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>


<span class="n">raw_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/raw_data.csv&#39;</span><span class="p">)</span>

<span class="n">raw_data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_data_df</span><span class="p">)</span>
<span class="n">cleaned_data_array</span> <span class="o">=</span> <span class="n">raw_data_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>

<span class="n">d</span> <span class="o">=</span> <span class="mf">0.506</span>
<span class="n">A0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">cleaned_data_array</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span>
<span class="n">stress</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">A0</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">cleaned_data_array</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
<span class="n">te</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Tensile Strength={ts}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Total Extension={te}&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span><span class="n">stress</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Strain (mm/mm)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Stress (MPa)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Stress Strain Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plot.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>When the code is run, the plot produced looks like the plot below:</p>
<p><img alt="plot" src="./posts/testing_science_code/images/plot.png"></p>
<p>In the code above, notice the line <code>raw_data_df = pd.read_csv('data/raw_data.csv')</code>  This line shows the .csv data file isn't in the same directory as the script. The .csv file is in a sub-directory called <code>data/</code>.</p>
<blockquote>
<p>In scientific code, it's a good idea to keep the data separate from the script that analyzes the data.</p>
</blockquote>
<p><em>How can we possibly write software tests for this script?</em></p>
<p><img alt="cup cakes" src="./posts/testing_science_code/images/cupcakes.jpg"></p>
<h2 id="testing-in-scientific-software-is-about-reproducibility">Testing in Scientific Software is about Reproducibility</h2>
<p>The first idea isn't code or a specific test, it's the idea that <strong>testing scientific code is about ensuring reproducibility</strong>. It's my understanding that testing software in general (not scientist's code) is about ensuring the system runs error-free and accomplishes what the programmer intends. In a scientist's code, my argument is that testing should be more about making sure the code is reproducible by other researchers (or more likely useable to the scientist 6 months later or a new grad student) than ensuring the code runs error-free or produces the desired result. </p>
<p><em>All scientists what their research to be reproducible, right?</em></p>
<p><img alt="code" src="./posts/testing_science_code/images/python_code.png"></p>
<h2 id="use-a-py-file-instead-of-a-jupyter-notebook">Use a .py-file instead of a Jupyter notebook</h2>
<p>The second idea is to write scientific code in a <strong>.py-file</strong> instead of writing the code in a Jupyter notebook. Now, I love Jupyter notebooks as much as the next Engineer. Jupyter notebooks are great for data exploration, plot creation, and presentation. But... Jupyter notebook cells can be run in any order. The execution order of a Jupyter notebook sometimes affects the output of the code.</p>
<p>When code is in a .py-file, the execution order of the lines of Python code is set by your programming logic. So ideally, each time you run the .py-file, the output is the same. Therefore after initial data exploration, move code from a Jupyter notebook into a .py-file.</p>
<blockquote>
<p>After initial data exploration, move code from a Jupyter notebook into a .py-file</p>
</blockquote>
<p>Within the Jupyter notebook interface, you can select <strong>File &rarr; Download As</strong> and select <strong>Python (.py)</strong> as the file type. </p>
<p><img alt="Download As in Jupyter notebook" src="./posts/testing_science_code/images/jupyter_notebook_download_as.jpg"></p>
<p>Move the downloaded <code>analysis.py</code> file to the main project directory where the <code>data</code> folder is, at the same level as <code>analysis.ipynb</code>. The top of <code>analysis.py</code> looks like the code below. Notice how Jupyter adds a shebang and encoding line at the top of the file.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="c1"># In[1]:</span>


<span class="c1"># analysis.ipynb</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">...</span>
</pre></div>


<p>After the Jupyter notebook is saved as a .py-file, run the .py-file from the command line. </p>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">python</span> <span class="n">analysis</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<p>The output produced by the .py-file should be the same as the Jupyter notebook output. In the next section, we'll deal with Python versions and dependencies.</p>
<p><img alt="pack mule" src="./posts/testing_science_code/images/pack_mule.jpg"></p>
<h2 id="define-package-dependencies-and-python-version">Define Package Dependencies and Python Version</h2>
<p>After the scientific script is saved in a .py-file, the next step is to define the Python version and dependencies needed to run the script. This can be accomplished by creating a <code>requirements.txt</code> file that contains the specific versions of the packages your script is run with. These packages just need to be the high-level dependencies that are imported by your script. The contents of a sample <code>requirements.txt</code> file are below. Note that <strong>pytest</strong> is also included as a dependency. We are going to use pytest a little later to test our script.</p>
<div class="highlight"><pre><span></span>numpy==1.19.2
pandas==1.2.2
matplotlib==3.3.4
pytest==6.2.2
</pre></div>


<p>If you don't know what version of matplotlib you are using, open the Python REPL and type:</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; import matplotlib
&gt;&gt;&gt; matplotlib.__version__
&#39;3.3.4&#39;
</pre></div>


<p>The <code>.__version__</code> attribute is commonly defined for popular Python packages. </p>
<p>In addition to the packages used by our script, we can also define which version of Python we're are using. The Python version can be stored in a file called <code>runtime.txt</code>. The contents of a <code>runtime.txt</code> file is below:</p>
<div class="highlight"><pre><span></span>python-3.8.5
</pre></div>


<p>If you don't know what version of Python you are using, it's easy to figure out. The Python version is shown when you enter the Python REPL. In a terminal type <code>python</code> and the version is printed out above the REPL prompt.</p>
<div class="highlight"><pre><span></span>&gt; python
Python 3.8.5 (default, Jul  2 2020, 17:30:36) [MSC v.1916 64 bit (AMD64)] :: Anaconda, Inc. on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</pre></div>


<p>At this point, we have converted an original Jupyter notebook into a Python script. We have also included a <code>requirements.txt</code> file and a <code>runtime.txt</code> file alongside our script. The directory structure of our growing project is shown below.</p>
<div class="highlight"><pre><span></span>project/
    analysis.ipynb
    analysis.py
    requirements.txt
    runtime.txt
    plot.png
    data/
        raw_data.csv
</pre></div>


<p>Our dependencies and Python version are defined. Let's write our first tests!</p>
<h2 id="test-dependency-versions-and-python-version">Test Dependency Versions and Python Version</h2>
<p>Now that we defined our package versions and Python version, we can write tests to confirm these are the same versions that run our script. If another researcher wants to run our script, they can confirm through our tests that they are using the same dependency versions we are.</p>
<h3 id="test-dependencies">Test Dependencies</h3>
<p>Create a new directory called <code>tests</code> and inside the <code>tests</code> directory, create a new file called <code>test_dependencies.py</code>. Also, create a blank <code>__init__.py</code> file alongside the <code>test_dependencies.py</code> file. You can leave <code>__init__.py</code> empty. The file just has to have the name <code>__init__.py</code>. This tile defines the <code>tests/</code> directory as a package.</p>
<p>The directory structure of our project now looks like:</p>
<div class="highlight"><pre><span></span>project/
    analysis.ipynb
    analysis.py
    requirements.txt
    runtime.txt
    plot.png
    data/
        raw_data.csv
    tests/
        __init__.py
        test_dependencies.py
</pre></div>


<p>Inside the <code>test_dependencies.py</code> file, we can write tests that confirm the versions of the packages we say are necessary in our <code>requirements.txt</code> file. Examples of these tests are below. The tests are written using <a href="https://docs.pytest.org/en/stable/contents.html">pytest</a>, an excellent testing framework that is pretty easy to use.</p>
<div class="highlight"><pre><span></span><span class="c1"># tests/test_dependencies.py</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">fp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span> <span class="s2">&quot;requirements.txt&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ver</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">d</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span>


<span class="k">def</span> <span class="nf">test_numpy_version</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>


<span class="k">def</span> <span class="nf">test_pandas_version</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">]</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">__version__</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>


<span class="k">def</span> <span class="nf">test_matplotlib_version</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">]</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">__version__</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>


<p>The code at the top of the file reads our <code>requirements.txt</code> file and parses our required packages and versions into a Python dictionary. Below are three tests, one test for each required package.</p>
<p>We can run these tests from the command line as long as pytest is installed. If it isn't installed, pytest can be installed with <strong>pip</strong></p>
<div class="highlight"><pre><span></span>&gt; pip install pytest
</pre></div>


<p>The command below runs the tests we defined in <code>test_dependencies.py</code> with pytest.</p>
<div class="highlight"><pre><span></span>&gt; python -m pytest tests/test_dependencies.py
</pre></div>


<p>The output should be something like below:</p>
<div class="highlight"><pre><span></span>============================== test session starts ===============================
platform linux -- Python 3.8.5, pytest-6.2.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/peter/Documents/testing-scientific-code
collected 3 items                                                                

tests/test_dependencies.py ...                                             [100%]

=============================== 3 passed in 0.25s ================================
</pre></div>


<p>If you want more information about the tests, use the <code>-v</code> flag.</p>
<div class="highlight"><pre><span></span>&gt; python -m pytest -v tests/test_dependencies.py
</pre></div>


<p>Using the <code>-v</code> flag provides additional information in the test output:</p>
<div class="highlight"><pre><span></span>collected 3 items                                                                

tests/test_dependencies.py::test_numpy_version PASSED                      [ 33%]
tests/test_dependencies.py::test_pandas_version PASSED                     [ 66%]
tests/test_dependencies.py::test_matplotlib_version PASSED                 [100%]

=============================== 3 passed in 0.25s ================================
</pre></div>


<p><em>Are you sure those are the package versions you are using?</em></p>
<p>If all the tests pass, that means the packages running the code are installed and the same versions specified in <code>requirements.txt</code> </p>
<h3 id="test-python-version">Test Python Version</h3>
<p>We can also write a test for the version of Python we're using.</p>
<p>Create a new file called <code>test_python_version.py</code> in the <code>tests/</code> directory. Add the code below to <code>test_python_version.py</code>. The test below ensures Python version 3.8.5 is used. That's the version of Python we specified in <code>runtime.txt</code>. Make sure to import the <code>platform</code> module from the Python Standard Library at the top of <code>test_python_version.py</code> or the test won't work.</p>
<div class="highlight"><pre><span></span><span class="c1"># tests/test_python_version.py</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">platform</span>


<span class="k">def</span> <span class="nf">test_python_version</span><span class="p">():</span>
    <span class="n">rt_fp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span> <span class="s2">&quot;runtime.txt&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rt_fp</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>


<p>The new test can be run on the command line with pytest.</p>
<div class="highlight"><pre><span></span>&gt; python -m pytest tests/test_python_version.py
</pre></div>


<p>The output should look something like this:</p>
<div class="highlight"><pre><span></span>collected 1 item                                                                 

tests/test_python_version.py .                                             [100%]

=============================== 1 passed in 0.01s ================================
</pre></div>


<p>If the test passes, that means the Python version (running the code) is the same as the Python version we specified in <code>runtime.txt</code>.</p>
<h3 id="test-character-encoding">Test Character Encoding</h3>
<p>One more test we can write is to test what character encoding is used. On most computers, the character encoding is <strong>utf-8</strong>. We can check for the character encoding by writing another test. Let's code this test in a file called <code>test_system_encoding.py</code> in the <code>tests/</code> directory. The character encoding test below uses the <code>sys</code> module. Make sure to import the <code>sys</code> module at the top of the <code>test_system_encoding.py</code> file.</p>
<div class="highlight"><pre><span></span><span class="c1"># tests/test_system_encoding.py</span>

<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">test_system_encoding</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getfilesystemencoding</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>


<p>We can run the test with pytest. </p>
<div class="highlight"><pre><span></span>python -m pytest tests/test_system_encoding.py
</pre></div>


<p>If your computer is using the utf-8 character encoding, the test will pass:</p>
<div class="highlight"><pre><span></span>============================== test session starts ===============================
platform linux -- Python 3.8.5, pytest-6.2.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/peter/Documents/testing-scientific-code
collected 1 item                                                                 

tests/test_system_encoding.py .                                            [100%]

=============================== 1 passed in 0.01s ================================
</pre></div>


<p>So far we have written tests in three different test files. Our project directory structure now looks like:</p>
<div class="highlight"><pre><span></span>project/
    analysis.ipynb
    analysis.py
    requirements.txt
    runtime.txt
    plot.png
    data/
        raw_data.csv
    tests/
        __init__.py
        test_dependencies.py
        test_python_version.py
        test_system_encoding.py
</pre></div>


<p><strong>Our 5 tests are great right?</strong> Yes, yes they are great. But...</p>
<p><em>How can we test the scientific code in the script <code>analysis.py</code> itself?</em> </p>
<p>Before we can test the script, we need to break the script up into functions.</p>
<h2 id="break-the-script-up-into-functions">Break the script up into functions</h2>
<p><img alt="holding hands" src="./posts/testing_science_code/images/kids-holding-hands.jpg"></p>
<p>Next, we are going to break our <code>analysis.py</code> script up into functions. Let's use the four bullet points below to help guide us through how to break the long <code>analysis.py</code> script into 3 or 4 pieces. </p>
<ul>
<li>Read in data</li>
<li>Clean or reorganize the data</li>
<li>Run calculations</li>
<li>Create a figure or plot</li>
</ul>
<p>The code below shows how each one of the steps can be encapsulated in a function. </p>
<div class="highlight"><pre><span></span><span class="c1"># analysis.py</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">import_data</span><span class="p">():</span>
    <span class="n">raw_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/raw_data.csv&#39;</span><span class="p">)</span>
    <span class="n">raw_data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_data_df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw_data_array</span>

<span class="k">def</span> <span class="nf">clean_data</span><span class="p">(</span><span class="n">raw_data_array</span><span class="p">):</span>
    <span class="n">cleaned_data_array</span> <span class="o">=</span> <span class="n">raw_data_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
    <span class="k">return</span> <span class="n">cleaned_data_array</span>

<span class="k">def</span> <span class="nf">get_stress_and_strain</span><span class="p">(</span><span class="n">cleaned_data_array</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mf">0.506</span>
    <span class="n">A0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">cleaned_data_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">F</span> <span class="o">/</span> <span class="n">A0</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">cleaned_data_array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
    <span class="k">return</span> <span class="n">stress</span><span class="p">,</span> <span class="n">strain</span>

<span class="k">def</span> <span class="nf">get_tensile_strength</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_total_extension</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Strain (mm/mm)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Stress (MPa)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Stress Strain Curve&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>Let's end the script by defining a <code>main()</code> function that calls the functions defined above in the proper order. Then we can call the <code>main()</code> function with an <code>if __name__ == "__main__":</code> line.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">raw_data_array</span> <span class="o">=</span> <span class="n">import_data</span><span class="p">()</span>
    <span class="n">clean_data_array</span> <span class="o">=</span> <span class="n">clean_data</span><span class="p">(</span><span class="n">raw_data_array</span><span class="p">)</span>
    <span class="n">stress</span><span class="p">,</span> <span class="n">strain</span> <span class="o">=</span> <span class="n">get_stress_and_strain</span><span class="p">(</span><span class="n">clean_data_array</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">get_tensile_strength</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">)</span>
    <span class="n">te</span> <span class="o">=</span> <span class="n">get_total_extension</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tensile Strength: {ts}, Total Extension: {te}&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>Run the script from the command line. </p>
<div class="highlight"><pre><span></span>&gt; python analysis.py
</pre></div>


<p>A plot should be produced and the output should be the same as when the script didn't contain any user-defined functions.</p>
<p>Now that we've divided our script up into functions, we can make sure our script doesn't modify our raw data by writing another test.</p>
<h2 id="test-if-the-code-modifies-the-data">Test if the code modifies the data</h2>
<p><img alt="ice" src="./posts/testing_science_code/images/ice.jpeg"></p>
<p>When our code runs, it should not modify, rename, rewrite or otherwise change our original data. </p>
<blockquote>
<p>Scientific code should not modify, rename or rewrite the original data</p>
</blockquote>
<p>Let's create a new test file in the <code>tests/</code> directory called <code>test_data_unchanged.py</code>. The directory structure should now look like:</p>
<div class="highlight"><pre><span></span>project/
    analysis.ipynb
    analysis.py
    requirements.txt
    runtime.txt
    plot.png
    data/
        raw_data.csv
    tests/
        __init__.py
        test_dependencies.py
        test_python_version.py
        test_system_encoding.py
        test_data_unchanged.py
</pre></div>


<p>The test to make sure our script doesn't change the raw data file is below. All the attributes listed in the test from the <code>os.stat</code> object should be the same before the script runs and after the script runs.</p>
<div class="highlight"><pre><span></span><span class="c1"># tests/test_data_unchanged.py</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">analysis</span>


<span class="k">def</span> <span class="nf">test_data_is_unchanged</span><span class="p">():</span>
    <span class="n">fp1</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/raw_data.csv&quot;</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fp1</span><span class="p">)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
    <span class="n">fp2</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/raw_data.csv&quot;</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fp2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">d1</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_mode</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_ino</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_ino</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_dev</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_dev</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_nlink</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_uid</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_uid</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_gid</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_gid</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_size</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="ow">and</span> <span class="n">d1</span><span class="o">.</span><span class="n">st_ctime</span> <span class="o">==</span> <span class="n">d2</span><span class="o">.</span><span class="n">st_ctime</span>
    <span class="p">)</span>
</pre></div>


<p>Run the <code>data_is_unchanged()</code> test from the command line. If the test passes, that means the data file <code>raw_data.csv</code> is not modified by our script.</p>
<div class="highlight"><pre><span></span>python -m pytest tests/test_data_unchanged.py

============================== test session starts ===============================
platform linux -- Python 3.8.5, pytest-6.2.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/peter/Documents/testing-scientific-code
collected 1 item                                                                 

tests/test_data_unchanged.py .                                             [100%]

========================== 1 passed, 1 warning in 0.40s ==========================
</pre></div>


<p>To test the functions in the script itself, it is helpful for each function in the script to accept input and produce output. Therefore, next, we'll modify the functions of our script and make sure each function includes inputs and outputs.</p>
<h2 id="ensure-each-function-accepts-input-and-produces-output">Ensure each function accepts input and produces output</h2>
<p><img alt="pipe" src="./posts/testing_science_code/images/pipe.jpeg"></p>
<p>Now that we know our script doesn't modify the data it uses, we are going to modify the functions of our script to be more testable. To make these functions more testable, we'll add inputs and output where possible.</p>
<p>Is it clear what the input and output of our functions should be? For a function that produces a plot, assign the outputs as Matplotlib <code>fig</code> and <code>ax</code> objects. The code below includes modifications to our script <code>analysis.py</code>.</p>
<div class="highlight"><pre><span></span><span class="c1"># analysis.py</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">import_data</span><span class="p">(</span><span class="n">f_path</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
    <span class="n">np_raw_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np_raw_array</span>


<span class="k">def</span> <span class="nf">clean_data</span><span class="p">(</span><span class="n">raw_np_array</span><span class="p">):</span>
    <span class="n">np_array</span> <span class="o">=</span> <span class="n">raw_np_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">np_array</span>


<span class="k">def</span> <span class="nf">get_stress_and_strain</span><span class="p">(</span><span class="n">cleaned_data_array</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mf">0.506</span>
    <span class="n">A0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">cleaned_data_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">F</span> <span class="o">/</span> <span class="n">A0</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">cleaned_data_array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
    <span class="k">return</span> <span class="n">stress</span><span class="p">,</span> <span class="n">strain</span>


<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">f_name</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="n">save_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">f_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">save_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span> <span class="nf">get_tensile_strength</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_total_extension</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
</pre></div>


<p>Now we can modify the <code>main()</code> function and include a file path for our raw data and file name for our saved figure.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">raw_data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data.csv&quot;</span><span class="p">)</span>
    <span class="n">raw_data_array</span> <span class="o">=</span> <span class="n">import_data</span><span class="p">(</span><span class="n">raw_data_path</span><span class="p">)</span>
    <span class="n">clean_data_array</span> <span class="o">=</span> <span class="n">clean_data</span><span class="p">(</span><span class="n">raw_data_array</span><span class="p">)</span>
    <span class="n">stress</span><span class="p">,</span> <span class="n">strain</span> <span class="o">=</span> <span class="n">get_stress_and_strain</span><span class="p">(</span><span class="n">clean_data_array</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Stress Strain Curve&quot;</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Strain (mm/mm)&quot;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Stress (MPa)&quot;</span>
    <span class="n">f_name</span> <span class="o">=</span> <span class="s2">&quot;plot.png&quot;</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">f_name</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">get_tensile_strength</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">)</span>
    <span class="n">te</span> <span class="o">=</span> <span class="n">get_total_extension</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">strain</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tensile Strength: {ts}, Total Extension: {te}&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>OK - our functions have inputs and outputs. Let's get to testing them with pytest.</p>
<h2 id="test-the-analysis-functions">Test the analysis functions</h2>
<p><img alt="pin wheel" src="./posts/testing_science_code/images/pin_wheel.jpg"></p>
<p>Now we are going to use <strong>pytest</strong> to test the analysis functions in our <code>analysis.py</code> script. Create a new file called <code>test_analysis.py</code> in the <code>tests/</code> directory. The directory strucuture now looks like:</p>
<div class="highlight"><pre><span></span>project/
    analysis.ipynb
    analysis.py
    requirements.txt
    runtime.txt
    data/
        raw_data.csv
    output/
        plot.png
    tests/
        __init__.py
        test_analysis.py
        test_dependencies.py
        test_python_version.py
        test_data_unchanged.py
        test_system_encoding.py
</pre></div>


<h3 id="create-some-sample-data">Create some sample data</h3>
<p>At the top of <code>test_analysis.py</code> let's add our imports and some sample data to test our functions with. </p>
<div class="highlight"><pre><span></span><span class="c1"># tests/test_analysis.py</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">analysis</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>


<p>Below the imports and data, we can write a test for each one of our analysis functions.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_tensile_strength</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get_tensile_strength</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_total_extension</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get_total_extension</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>Our two analysis tests can be run from the command line with pytest.</p>
<div class="highlight"><pre><span></span>&gt; python -m pytest tests/test_analysis.py
</pre></div>


<p>Hopefully, both tests pass.</p>
<div class="highlight"><pre><span></span>============================== test session starts ===============================
platform linux -- Python 3.8.5, pytest-6.2.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/peter/Documents/testing-scientific-code
collected 2 items                                                                

tests/test_analysis.py ..                                                  [100%]

=============================== 2 passed in 0.39s ================================
</pre></div>


<p>Next, we'll test our plot construction. Testing the plot is a little more complicated than our other tests. To test the plot, we'll use a great feature of pytest called <em>fixtures</em>.</p>
<h2 id="test-the-plot">Test the plot</h2>
<p>Testing the construction of Matplotlib plots is a little more difficult than testing our analysis functions. We aren't going to test every last bit of plot construction, but we can test parts of the plot, like confirming the axis labels and titles are added correctly. </p>
<p>To test the plot, it's useful to create a plot to test. Since each test needs this plot to be created, we'll create a pytest <em>fixture</em> that can be used in each of our plot tests. The fixture saves us from writing the same plot construction code in each test.</p>
<p>We'll test the plot in a new test file called <code>test_plot.py</code>. There should be a total of six test files in our <code>tests/</code> directory. The files in the <code>tests/</code> directory are shown below.</p>
<div class="highlight"><pre><span></span>tests/
    test_analysis.py
    test_data_unchanged.py
    test_dependencies.py
    test_plot.py
    test_python_version.py
    test_system_encoding.py
</pre></div>


<p>At the top of <code>test_plot.py</code> we include our imports and define our fixture function called <code>set_up_plot()</code>. Notice the pytest <code>@pytest.fixture</code> decorator attached to the fixture function.</p>
<div class="highlight"><pre><span></span><span class="c1"># tests/test_plot.py</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">import</span> <span class="nn">analysis</span>


<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">set_up_plot</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;my_title&quot;</span><span class="p">,</span> <span class="s2">&quot;my_x_axis_label&quot;</span><span class="p">,</span> <span class="s2">&quot;my_y_axis_label&quot;</span><span class="p">,</span> <span class="s2">&quot;plot.png&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</pre></div>


<p>Below the fixture, we can add tests for the plot. We feed the fixture function into the test functions as an input argument. Within the body of the test functions, we can extract the outputs of our fixture function <code>set_up_plot()</code> and test against them.</p>
<p>Note how our fixture function above returns a tuple. The first item in the tuple is a matplotlib figure object <code>fig</code> and the second item in the tuple is a matplotlib axes object <code>ax</code>. Calling <code>set_up_plot[0]</code> within a test definition returns <code>fig</code> and calling <code>set_up_plot[1]</code> returns <code>ax</code>. Five tests of the plot are below.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_plot_x_axis_label</span><span class="p">(</span><span class="n">set_up_plot</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">set_up_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;my_x_axis_label&quot;</span>


<span class="k">def</span> <span class="nf">test_plot_y_axis_label</span><span class="p">(</span><span class="n">set_up_plot</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">set_up_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;my_y_axis_label&quot;</span>


<span class="k">def</span> <span class="nf">test_plot_title_label</span><span class="p">(</span><span class="n">set_up_plot</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">set_up_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;my_title&quot;</span>


<span class="k">def</span> <span class="nf">test_figure_object</span><span class="p">(</span><span class="n">set_up_plot</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">set_up_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span>


<span class="k">def</span> <span class="nf">test_axes_object</span><span class="p">(</span><span class="n">set_up_plot</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">set_up_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">set_up_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
</pre></div>


<p>Run the tests with pytest:</p>
<div class="highlight"><pre><span></span>&gt; python -m pytest tests/test_plot.py
</pre></div>


<p>The output should be similar to the output below:</p>
<div class="highlight"><pre><span></span>collected 5 items

tests/test_plot.py::test_plot_x_axis_label PASSED                      [ 20%]
tests/test_plot.py::test_plot_y_axis_label PASSED                      [ 40%]
tests/test_plot.py::test_plot_title_label PASSED                       [ 60%]
tests/test_plot.py::test_figure_object PASSED                          [ 80%]
tests/test_plot.py::test_axes_object PASSED                            [100%]

=============================== 5 passed in 2.63s ================================
</pre></div>


<h2 id="run-all-the-tests">Run all the tests</h2>
<p>We can run all the tests we have written, in all the test files at once by passing the whole <code>tests/</code> directory to pytest</p>
<div class="highlight"><pre><span></span>&gt; python -m pytest tests/
</pre></div>


<p>The output should be similar to:</p>
<div class="highlight"><pre><span></span>collected 13 items

tests\test_analysis.py ..                                              [ 15%] 
tests\test_data_unchanged.py .                                         [ 23%]
tests\test_dependencies.py ...                                         [ 46%]
tests\test_plot.py .....                                               [ 84%]
tests\test_python_version.py .                                         [ 92%]
tests\test_system_encoding.py .                                        [100%]

=============================== 13 passed in 4.17s ===============================
</pre></div>


<p>Nice! We wrote a total of 13 tests in 6 different test files and they all passed! </p>
<h2 id="wrap-up">Wrap-Up</h2>
<p>In this post, we tested a scientific script using pytest. We accomplished this in a couple of steps. </p>
<ul>
<li>convert Jupyter notebook to a .py-file</li>
<li>divide .py-file up into functions</li>
<li>test Python version, dependencies, and text encoding</li>
<li>test the script doesn't change the data</li>
<li>test the analysis functions</li>
<li>test the plot</li>
</ul>
<p>Tests like the ones shown in this post could be written for scripts written by scientists that follow the same basic steps of data ingest and cleaning, analysis, and plotting. I hope you found this useful and can use some of these testing ideas in your code.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="./thoughts-on-software-design-in-scientific-code.html">Thoughts on Software Design in Scientific Code</a></li>
        <li><a href="./calculating-vacancy-concentration-with-python.html">Calculating Vacancy Concentration with Python</a></li>
        <li><a href="./offset-piston-motion-animation-matplotlib.html">Offset Piston Motion with Python and Matplotlib</a></li>
        <li><a href="./how-to-make-y-y-plots-with-matplotlib.html">How to make y-y plots with Matplotlib</a></li>
        <li><a href="./streamlit-app-with-bokeh.html">How to Build a Streamlit App in Python</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
    </div>
    <!-- AddThis Button END -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Ethical Ads -->
<div class="horizontal" data-ea-publisher="pythonforundergradengineers-com" data-ea-type="image"></div>
<!-- end Ethical Ads --><div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="./extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="./crank-and-rocker-motion-with-python-and-matplotlib.html">Crank and Rocker Motion with Python and Matplotlib</a></li>
    <li class="list-group-item"><a href="./what-is-ansible.html">What is Ansible?</a></li>
    <li class="list-group-item"><a href="./how-to-change-a-github-repo-from-master-to-main.html">How to change a GitHub repo from master to main</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="./"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-2">
      <a href="./tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/flask.html">flask</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/jupyter-notebook.html">jupyter notebook</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/matplotlib.html">matplotlib</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/sensor.html">sensor</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <script src="./static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = './theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="./theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
<!-- Ethical Ads JS-->
<script async src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
<!-- end Ethical Ads JS -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cdd8eb4e16bf94c"></script>
</body>
</html>