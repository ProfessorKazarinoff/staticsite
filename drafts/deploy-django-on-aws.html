<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Deploy a Django Web App on Amazon Web Services (AWS) - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

    /*some stuff for output/input prompts*/
    div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
    div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
    div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
    div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
    @media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
    div.prompt:empty{padding-top:0;padding-bottom:0}
    div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
    div.inner_cell{width:90%;}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
    div.input_prompt{color:navy;border-top:1px solid transparent;}
    div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
    div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
    div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
    div.output_prompt{color:darkred;}
    
    a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
    h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
    /* end stuff for output/input prompts*/
    
    
    .highlight-ipynb .hll { background-color: #ffffcc }
    .highlight-ipynb  { background: #f8f8f8; }
    .highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
    .highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
    .highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
    .highlight-ipynb .o { color: #666666 } /* Operator */
    .highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
    .highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
    .highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
    .highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
    .highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
    .highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
    .highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
    .highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
    .highlight-ipynb .go { color: #888888 } /* Generic.Output */
    .highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
    .highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
    .highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
    .highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
    .highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
    .highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
    .highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
    .highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
    .highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
    .highlight-ipynb .m { color: #666666 } /* Literal.Number */
    .highlight-ipynb .s { color: #BA2121 } /* Literal.String */
    .highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
    .highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
    .highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
    .highlight-ipynb .no { color: #880000 } /* Name.Constant */
    .highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
    .highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
    .highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
    .highlight-ipynb .nf { color: #0000FF } /* Name.Function */
    .highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
    .highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
    .highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
    .highlight-ipynb .nv { color: #19177C } /* Name.Variable */
    .highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
    .highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
    .highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
    .highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
    .highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
    .highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
    .highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
    .highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
    .highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
    .highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
    .highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
    .highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
    .highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
    .highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
    .highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
    .highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
    .highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
    .highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
    .highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
    .highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
    .highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
    .highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
    
    <style type="text/css">
    /* Overrides of notebook CSS for static HTML export */
    div.entry-content {
      overflow: visible;
      padding: 8px;
    }
    .input_area {
      padding: 0.2em;
    }
    
    a.heading-anchor {
     white-space: normal;
    }
    
    .rendered_html
    code {
     font-size: .8em;
    }
    
    pre.ipynb {
      color: black;
      background: #f7f7f7;
      border: none;
      box-shadow: none;
      margin-bottom: 0;
      padding: 0;
      margin: 0px;
      font-size: 13px;
    }
    
    /* remove the prompt div from text cells */
    div.text_cell .prompt {
        display: none;
    }
    
    /* remove horizontal padding from text cells, */
    /* so it aligns with outer body text */
    div.text_cell_render {
        padding: 0.5em 0em;
    }
    
    img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
    
    div.collapseheader {
        width=100%;
        padding: 2px;
        cursor: pointer;
        font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
    }
    
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
    <script type="text/javascript">
    init_mathjax = function() {
        if (window.MathJax) {
            // MathJax loaded
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                },
                displayAlign: 'center', // Change this to 'center' to center equations.
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 0}}
                }
            });
            MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    
    <link href="../extra/favicon.ico" rel="icon">

<link rel="canonical" href="../drafts/deploy-django-on-aws.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="python,django,aws" />
        <meta name="description" content="In this post, we are going to deploy a Django Web App on Amazon Web Services (AWS). More specifically, we are going to deploy a pre-built Django App saved on GitHub to an AWS EC2 instance. Follow along to learn how to deploy your own Django Web App on AWS." />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Deploy a Django Web App on Amazon Web Services (AWS)"/>
        <meta property="og:url" content="../drafts/deploy-django-on-aws.html"/>
        <meta property="og:description" content="In this post, we are going to deploy a Django Web App on Amazon Web Services (AWS). More specifically, we are going to deploy a pre-built Django App saved on GitHub to an AWS EC2 instance. Follow along to learn how to deploy your own Django Web App on AWS."/>
        <meta property="article:published_time" content="2018-12-15" />
            <meta property="article:section" content="django" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="django" />
            <meta property="article:tag" content="aws" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="../theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../theme/css/pygments/native.css" rel="stylesheet">
    <link href="../theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="../theme/css/style.css" type="text/css"/>
        <link href="../static/css/custom.css" rel="stylesheet">



</head>
<body>

<!-- .navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="../pages/about.html">
                             About
                          </a></li>
                         <li><a href="../pages/book.html">
                             Book
                          </a></li>
                         <li><a href="../pages/gear.html">
                             Gear
                          </a></li>
                         <li><a href="../pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">

<!-- .navbar-search -->
<li>
    <span>
        <form class="navbar-search" action="/search.html">
            <input type="text" name="q" id="tipue_search_input">
        </form>
    </span>
</li>
<!-- /.navbar-search -->              <li><a href="../archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href=".." title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="../category/django.html" title="django">django</a></li>
                <li class="active">Deploy a Django Web App on Amazon Web Services (AWS)</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../drafts/deploy-django-on-aws.html"
                       rel="bookmark"
                       title="Permalink to Deploy a Django Web App on Amazon Web Services (AWS)">
                        Deploy a Django Web App on Amazon Web Services (AWS)
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-12-15T14:36:00-08:00"> Sat 15 December 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="../tag/python.html">python</a>
        /
	<a href="../tag/django.html">django</a>
        /
	<a href="../tag/aws.html">aws</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In this post, we are going to deploy a Django App (the Oregon Engineering Transfer App) on Amazon Web Services (AWS). More specifically, we are going to deploy this Django web app on an AWS EC2 instance. An EC2 instance is AWS-speak for a virtual private server hosted by Amazon. This same type of virtual private server is available from other companies such as Digital Ocean and Linode. AWS calls virtual private servers <em>EC2 instances</em>.</p>
<p>Django is a Python package used to create Web Apps. Django can be used to create a simple one-page website, a web-based API service or a complex multi-page site. </p>
<p>An advantage of deploying our Django app on AWS, compared to Digital Ocean or Linode, is AWS has a free tier. The AWS free tier includes one EC2 instance (one server) for free for one year. Therefore, running our Django App on AWS should be free for a while (but don't forget that it's running...).</p>
<p>The deployment steps below are a slight modification of a procedure from <a href="https://www.codingdojo.com/">Coding Dojo</a>. Coding Dojo hosts coding boot camps to get programmers ready for jobs quickly. Their in-person coding bootcamps are 14 weeks long. The Coding Dojo bootcamps include Python, Django and Flask in the curriculum as well as other web development stacks.</p>
<p>A summary of steps to deploy our Django App on AWS is below:</p>
<div class="toc"><span class="toctitle">Table of contents:</span><ul>
<li><a href="#sign-up-for-amazon-web-services-aws-account">Sign up for Amazon Web Services (AWS) account</a></li>
<li><a href="#update-requirementstxt-and-push-to-github">Update requirements.txt and push to GitHub</a></li>
<li><a href="#create-and-log-into-the-aws-instance">Create and log into the AWS instance</a></li>
<li><a href="#update-the-server">Update the server</a></li>
<li><a href="#install-packages-with-apt">Install packages with apt</a></li>
<li><a href="#clone-the-github-repo">Clone the GitHub repo</a></li>
<li><a href="#install-virtualenv">Install virtualenv</a></li>
<li><a href="#create-a-new-virtual-environement">Create a new virtual environement</a></li>
<li><a href="#install-python-packages">Install Python packages</a></li>
<li><a href="#install-gunicorn-bcrypt-and-django-extensions">Install gunicorn, bcrypt and django-extensions</a></li>
<li><a href="#modify-settingspy">Modify settings.py</a></li>
<li><a href="#collect-static">Collect Static</a></li>
<li><a href="#test-gunicrn">Test gunicrn</a></li>
<li><a href="#create-gunicornservice-file">Create gunicorn.service file</a></li>
<li><a href="#run-gunicorn-service">Run gunicorn service</a></li>
<li><a href="#create-nginx-configuration">Create nginx configuration</a></li>
<li><a href="#link-the-nginx-configuration-and-restart-nginx">Link the nginx configuration and restart nginx</a></li>
<li><a href="#view-site-at-django-app-with-a-web-browser">View site at Django app with a web browser</a></li>
<li><a href="#why-this-is-not-a-permenent-solution">Why this is not a permenent solution</a></li>
</ul>
</div>
<h2 id="sign-up-for-amazon-web-services-aws-account">Sign up for Amazon Web Services (AWS) account</h2>
<p>Sign up for an Amazon Web Services (AWS) account here:</p>
<blockquote>
<p><a href="https://aws.amazon.com/">https://aws.amazon.com/</a></p>
</blockquote>
<p>Once you sign up for an account, you have to go to your email and activate your AWS account. After your account is active, log into the AWS Console by browsing to <a href="https://aws.amazon.com">aws.amazon.com</a> and clicking the [Sign into Console] button on the upper right.</p>
<p><img alt="AWS sign into console" src="../posts/django/images/aws_sign_into_console_button.png"></p>
<p>Once signed in, you are greeted by the ASW Managment Console:</p>
<p><img alt="AWS Management Console" src="../posts/django/images/aws_management_console.png"></p>
<h2 id="update-requirementstxt-and-push-to-github">Update requirements.txt and push to GitHub</h2>
<p>Back at the local machine, open the Anaconda Prompt and activate the <code>(transfer)</code> virtual environment. Then <code>cd</code> into the <code>transfer</code> project.</p>
<p>Use <code>pip freeze</code> to create a <code>requirement.txt</code> file. On Windows, the command <code>pip freeze &gt; requirements.txt</code> was needed. Note the <code>&gt;</code> character in the middle of the command. The <code>requirements.txt</code> file contains all the Python packages used in the <code>(transfer)</code> virtual environment.</p>
<p>Later, we will install these same Python packages on the AWS server. </p>
<div class="highlight"><pre><span></span>$ conda activate transfer

(transfer)$ cd transfer
(transfer)$ pwd
/home/Documents/transfer
(transfer)$ ls
courses/           docs/       pages/            templates/
db.sqlite3         LICENSE     README.md         transfer_project/  manage.py*  users/

(transfer)$ pip freeze &gt; requirements.txt
</pre></div>


<p>Take a look at the <code>requirments.txt</code> file. Ensure the file contains Django, django-crispy-forms and django-bootstrap. A partial listing of the <code>requirements.txt</code> file is below:</p>
<div class="highlight"><pre><span></span>certifi==2018.10.15
Click==7.0
Django==2.1.2
django-crispy-forms==1.7.0
Jinja2==2.10
livereload==2.5.2

...
</pre></div>


<p>We also need to modify the <code>.gitignore</code> file. We need to make sure the <code>env/</code> directory isn't saved up on GitHub or copied directly from GitHub to our EC2 instance. Open the <code>.gitignore</code> file and add <code>env/</code> on it's own line at the bottom of the file. This addition will ensure that the virtual environment we create on the server does not get saved in our git revision history.</p>
<div class="highlight"><pre><span></span># .gitignore

# Ignore the entire env directory
env/
</pre></div>


<p>Save the <code>.gitignore file</code>. Add, commit and push the changes to GitHub. </p>
<div class="highlight"><pre><span></span>(transfer)$ git add .
(transfer)$ git commit -m &quot;updated requirements.txt&quot;
(transfer)$ git push origin master
</pre></div>


<p>Do a quick check that the Django project runs without errors and works as expected on your local machine. </p>
<p>If the Django project doesn't run on your local machine, there is no way the Django project will work on the AWS cloud server. Start the development server on the local machine with the command below:</p>
<div class="highlight"><pre><span></span>(transfer)$ pwd
# make sure manage.py is in the current working directory

(transfer)$ python manage.py runserver

Django version 2.1.2, using settings &#39;transfer_project.settings&#39;
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
</pre></div>


<p>Point a web browser to:</p>
<blockquote>
<p><a href="http://localhost:8000/">http://localhost:8000/</a></p>
</blockquote>
<p>See your Django app running in all it's glory:</p>
<p><img alt="Transfer App home page" src="#"></p>
<p>Use [Ctrl]-[c] to shut down the development server.</p>
<p>The following tasks are now complete:</p>
<ul>
<li><code>requirements.txt</code> created</li>
<li>changes pushed to GitHub</li>
<li>the Django App runs locally as expected with no errors</li>
</ul>
<p>Now close the Anaconda Prompt. We'll use the Git Bash terminal (instead of the Anaconda Prompt) later in the deployment.</p>
<h2 id="create-and-log-into-the-aws-instance">Create and log into the AWS instance</h2>
<p>Log into the AWS Web Console at the following link:</p>
<blockquote>
<p><a href="https://aws.amazon.com/console/">https://aws.amazon.com/console/
</a></p>
</blockquote>
<p><img alt="AWS Login Screen" src="../posts/django/images/aws_login_screen.png"></p>
<p>In the AWS Console window select Service &rarr; Compute &rarr; EC2 &rarr; Launch Instance.</p>
<p><img alt="AWS services menu" src="../posts/django/images/aws_services_EC2.png"></p>
<p><img alt="AWS Resources Launch Instance" src="../posts/django/images/aws_create_instance_launch_instance.png"></p>
<p>Scroll down the operating system options and select <code>Ubuntu Server 16.04 LTS (HVM), SSD Volume Type</code>. This option is part of the AWS free tier.</p>
<p><img alt="AWS Ubuntu 16.04 Option" src="../posts/django/images/aws_select_ubuntu16dot04_server.png"></p>
<p>Choose [select] then [Review and Launch].</p>
<p><img alt="AWS review and launch" src="../posts/django/images/aws_review_and_launch.png"></p>
<p>Before we [Launch] the final server, we need to edit the security group options. Scroll down and select [Edit Security Groups]</p>
<p><img alt="AWS security groups" src="../posts/django/images/aws_edit_security_groups.png"></p>
<p>Add the following security options:</p>
<ul>
<li>SSH - your personal IP, auto-populates</li>
<li>HTTP - Anywhere, all IPs</li>
<li>HTTPS - Anywhere, all IPs</li>
</ul>
<p><img alt="AWS security options" src="../posts/django/images/aws_security_groups_added.png"></p>
<p>After the three security rules are added, click [Review and Launch]</p>
<p>At the review screen, click [Launch]</p>
<p><img alt="AWS_final_launch" src="../posts/django/images/aws_final_launch.png"></p>
<p>In the pop-up window, select [Create a New Key Pair] from the dropdown menu. </p>
<p><img alt="AWS download key pair" src="../posts/django/images/aws_download_key_pair.png"></p>
<p>Move the <code>.pem</code> key from the <code>Downloads</code> folder to a known location. Note the location where the <code>.pem</code> key file was moved to. We will need to <code>cd</code> into that location to log into the server.</p>
<p>Finally, click the [Launch Instances] at the bottom of the pop-up box. </p>
<p><img alt="AWS popup launch instances" src="../posts/django/images/aws_popup_final_launch_instances.png"></p>
<p>This produces a status window that shows our instance is launching. It takes a minute or two for the instance to launch. </p>
<p><img alt="AWS intances launching" src="../posts/django/images/aws_launch_status.png"></p>
<p>Scroll down and click [View Instances].</p>
<p><img alt="AWS view instances" src="../posts/django/images/aws_view_instances_button.png"></p>
<p>You can change the instance name by clicking the pencil icon in the [name] field.</p>
<p><img alt="AWS change name" src="../posts/django/images/aws_change_name_pencil.png"></p>
<p>Select the instance (box to the left of the instance name turns blue when instance is selected) and click [Connect]</p>
<p><img alt="AWS Connect Button" src="../posts/django/images/aws_connect_to_instance.png"></p>
<p>Copy the SSH connection command from the pop-up window. We will run this command in the Git Bash prompt.</p>
<p><img alt="AWS SSH Command" src="../posts/django/images/aws_copy_SSH_command.png"></p>
<p>Open the Git Bash Prompt, and <code>cd</code> into the directory where the <code>.pem</code> file we downloaded earlier is saved. Run the <code>ls</code> command and make sure the <code>.pem</code> file downloaded earlier is present. </p>
<p><img alt="Git Bash in start window" src="../posts/django/images/git_bash_in_start_window.png"></p>
<p>Copy the SSH login command from the AWS console pop-up window into the Git Bash Prompt. The right mouse button can be used to paste.</p>
<p><img alt="Git Bash paste SSH command" src="../posts/django/images/git_bash_paste.png"></p>
<p>Enter <code>yes</code> at the prompt to connect.</p>
<p><img alt="Git Bash yes" src="../posts/django/images/git_bash_sure_connect_yes.png"></p>
<p>You will see the terminal prompt for the AWS server in the command window. Type the <code>pwd</code> command to print the current working directory. You should be in the <code>/home/ubuntu</code> directory.</p>
<div class="highlight"><pre><span></span># on server
$ pwd
/home/ubuntu
</pre></div>


<p><img alt="Git Bash ls after login" src="../posts/django/images/git_bash_pwd_after_login.png"></p>
<p>We have now completed the following steps:</p>
<ul>
<li>launched a new AWS EC2 instance</li>
<li>logged into our new AWS EC2 intance with Git Bash</li>
</ul>
<h2 id="update-the-server">Update the server</h2>
<p>After the AWS server is created, the operating system and installed packages on the server should be updated. Run the following commands in the Git Bash window</p>
<div class="highlight"><pre><span></span>$ sudo apt-get update

$ sudo apt-get upgrade
</pre></div>


<p>When asked <code>What would you like to do about modified configuration file grub?</code> Type <code>1</code> to choose <code>install the package maintainer's version</code> </p>
<p><img alt="What to do with grub file" src="#"></p>
<p>After all the operating system and installed packages are upgraded, run the command <code>sudo apt-get update</code> again. You should see that updates are 100 percent complete.</p>
<p><img alt="updates complete" src="../posts/django/images/final_apt_get_upade.png"></p>
<h2 id="install-packages-with-apt">Install packages with apt</h2>
<p>Now that the server and the server's installed packages are up-to-date, we can install the packages we need to get the Django app up and running. Run the following commands:</p>
<div class="highlight"><pre><span></span>$ sudo apt-get install python-pip python-dev nginx git tree curl wget
</pre></div>


<p>Type <code>y</code> to confirm the installation. After the packages are installed, run <code>apt-get upgrade</code> again to make sure the packages we installed are all up-to-date.</p>
<div class="highlight"><pre><span></span>$ sudo apt-get upgrade
</pre></div>


<h2 id="clone-the-github-repo">Clone the GitHub repo</h2>
<p>Next, we'll clone the GitHub repo that contains our Django project. Note the <code>repo_name</code> directory name is spelled out after the url. This means the contents of the GitHub repo will be placed in a directory called <code>repo_name</code>. If this is omitted, the contents of the repo will go into a directory called <code>Oregon-Engineering-Transfer-App</code>. That's a long directory name to type. <code>repo_name</code> is easier to type and will hopefully cut down on errors later in the deployment process.</p>
<div class="highlight"><pre><span></span>$ git clone https://github.com/ProfessorKazarinoff/Oregon-Engineering-Transfer-App.git repo_name

$ ls
repo_name
</pre></div>


<h2 id="install-virtualenv">Install virtualenv</h2>
<p>We will run our Django app with Python3, not legacy Python (version 2.7). We'll install <code>virtualenv</code> with <code>pip</code> so that we can create a virtual environment for our Django App to run in.</p>
<div class="highlight"><pre><span></span>$ sudo pip install virtualenv
</pre></div>


<h2 id="create-a-new-virtual-environement">Create a new virtual environement</h2>
<p>With <code>virtualenv</code> installed, we can <code>cd</code> into the <code>repo_name</code> directory and create a new virtual environment called <code>env</code> that contains Python3. Then we'll activate the virtual environment with <code>source env/bin/activate</code>. Note that when the virtual environment is activate, the environment name <code>(env)</code> is shown before the command prompt.</p>
<div class="highlight"><pre><span></span>$ cd repo_name
$ ls
manage.py requirements.txt
$ virtualenv env --python=python3
$ source env/bin/activate
(env)$
</pre></div>


<h2 id="install-python-packages">Install Python packages</h2>
<p>Make sure the <code>(env)</code> virtual environment is activate and we are in the <code>repo_dir</code> base directory that contains the <code>requirements.txt</code> file. Install all of the Python packages in one go with <code>pip install -r requirements.txt</code>.</p>
<div class="highlight"><pre><span></span>(env)$ pwd
/home/ubuntu/repo_name

(env)$ ls
courses           env        pages             templates
deployment-notes  LICENSE    README.md         transfer_project
docs              manage.py  requirements.txt  users

(env)$ pip install -r requirements.txt
</pre></div>


<p>Make sure all the packages in the requirements.txt file are installed without an error. If there is a problem, you may need to remove a package that was <code>conda</code> installed that can't be installed by <code>pip</code>.</p>
<p>The packages we need are below. When these are <code>pip</code> installed, the terminal should output <code>Requirement already satisfied</code></p>
<div class="highlight"><pre><span></span>(env)$ pip install django
(env)$ pip install django-crispy-forms
</pre></div>


<h2 id="install-gunicorn-bcrypt-and-django-extensions">Install gunicorn, bcrypt and django-extensions</h2>
<p>We need a couple of extra Python packages for our Django deployment on AWS. Install them with <code>pip</code>. Make sure the <code>(env)</code> virtual environment is active when the <code>pip install</code> command is run.</p>
<div class="highlight"><pre><span></span>(env)$ pip install gunicorn
(env)$ pip install bcrypt django-extensions
</pre></div>


<h2 id="modify-settingspy">Modify <code>settings.py</code></h2>
<p>Next we'll modify the <code>settings.py</code> file in the <code>repo_name/transfer_project</code> directory.</p>
<div class="highlight"><pre><span></span>(env)$ cd transfer_project

(env)$ ls
__init__.py  settings.py  urls.py  wsgi.py

(env)$ nano settings.py
</pre></div>


<p>Add the AWS instance IP address to the allowed hosts, set debug to False.</p>
<div class="highlight"><pre><span></span>#transfer_project/settings.py
...

DEBUG = False
ALLOWED_HOSTS =[&#39;aws instance IP address&#39;]
</pre></div>


<p>At the bottom of <code>settings.py</code> add a line for the static root file path:</p>
<div class="highlight"><pre><span></span># At the bottom of /transfer_project/settings.py

STATIC_ROOT = os.path.join(BASE_DIR, &quot;static/&quot;)
</pre></div>


<p>[Ctrl]-[x] and [yes] to save and exit.</p>
<h2 id="collect-static">Collect Static</h2>
<p>Now we'll copy the static files into the directory we specified in the <code>STATIC_ROOT</code> setting of the <code>settings.py</code> file. We'll also migrate the database with the <code>makemigrations</code> and <code>migrate</code> commands.</p>
<div class="highlight"><pre><span></span>(env)$ cd ~/repo_name
(env)$ python manage.py collectstatic
(env)$ python manage.py makemigrations
(env)$ python manage.py migrate.
</pre></div>


<h2 id="test-gunicrn">Test gunicrn</h2>
<p>Next we'll test that <code>gunicorn</code> can work with our Django app. When the <code>--bind</code> command is run, you should not see any errors. Type [Ctrl]-[c] to exit.</p>
<div class="highlight"><pre><span></span>(env)$ gunicorn --bind 0.0.0.0:8000 transfer_project.wsgi:application
# should see no errors
</pre></div>


<p>Now deactivate the <code>(env)</code> virtual environment. After deactivation, there should no longer be an <code>(env)</code> before command prompt</p>
<div class="highlight"><pre><span></span>(env)$ deactivate
$
</pre></div>


<h2 id="create-gunicornservice-file">Create gunicorn.service file</h2>
<p>We are going to run <code>gunicorn</code> as a system service. To run <code>gunicorn</code> as a system service, we need to create a systemd configuration file.</p>
<div class="highlight"><pre><span></span>$ sudo vim /etc/systemd/system/gunicorn.service
</pre></div>


<p>Fill out the <code>gunicorn.service</code> file as below. Note you need to type <code>i</code> in the vim text editor to enter "insert" mode. Type [Esc] to go back to command mode. The command to write and quit is <code>:wq</code>.</p>
<div class="highlight"><pre><span></span>[Unit]
Description=gunicorn daemon
After=network.target
[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/repo_name
ExecStart=/home/ubuntu/repo_name/env/bin/gunicorn --workers 3 --bind unix:/home/ubuntu/repo_name/transfer_project.sock transfer_project.wsgi:application
[Install]
WantedBy=multi-user.target
</pre></div>


<h2 id="run-gunicorn-service">Run gunicorn service</h2>
<p>Now we'll run the <code>gunicorn</code> system service. Type the following commands. After the <code>status</code> command, you should see <code>Active: active (running)</code> in the Git Bash window. If you see <code>Failed</code> then something is wrong with the <code>gunicorn.service</code> file created earlier.</p>
<div class="highlight"><pre><span></span>$ sudo systemctl daemon-reload
$ sudo systemctl start gunicorn
$ sudo systemctl enable gunicorn
$ sudo systemctl status gunicorn

 gunicorn.service - gunicorn daemon
   Loaded: loaded (/etc/systemd/system/gunicorn.service; enabled; vendor preset: enabled)
   Active: active (running)
</pre></div>


<h2 id="create-nginx-configuration">Create nginx configuration</h2>
<p>Next we'll write an <code>nginx</code> configuration file. </p>
<div class="highlight"><pre><span></span>$ sudo vim /etc/nginx/sites-available/transfer_project
</pre></div>


<p>Fill out the <code>transfer_project</code> file as below. Make sure to modify the text <code>AWS_server_IP_no_quotes</code> with the IP address of the AWS instance. The IP should not be surrounded by quotes and should be followed by a semicolon. </p>
<div class="highlight"><pre><span></span>server {
  listen 80;
  server_name AWS_server_IP_no_quotes;
  location = /favicon.ico { access_log off; log_not_found off; }
  location /static/ {
        root /home/ubuntu/repo_name;
  }
  location / {
        include proxy_params;
        proxy_pass http://unix:/home/ubuntu/repo_name/transfer_project.sock;
  }
}
</pre></div>


<h2 id="link-the-nginx-configuration-and-restart-nginx">Link the nginx configuration and restart nginx</h2>
<p>Getting close to the end. Now we'll create a symbolic link between the <code>sites-available/transfer_project</code> file and the <code>sites-enabled</code> directory. This effectively puts the <code>nginx</code> configuration file we constructed in the <code>sites-available</code> directory into the <code>sites-enabled</code> directory. </p>
<div class="highlight"><pre><span></span>$ sudo ln -s /etc/nginx/sites-available/transfer_project /etc/nginx/sites-enabled
</pre></div>


<p>Run run <code>nginx -t</code> to see if there are any errors in the configuration file. The results should be <code>syntax is ok</code> and <code>test is successful</code>. </p>
<div class="highlight"><pre><span></span>$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</pre></div>


<p>If the nginx configuration works, remove the <code>default</code> file from the <code>sites-enabled</code> directory with the <code>rm</code> command. </p>
<div class="highlight"><pre><span></span>$ sudo rm /etc/nginx/sites-enabled/default
</pre></div>


<p>Finally restart <code>nginx</code> and check the status. If the results are <code>Active: active (running)</code>, the deployment is successful. All that is left to do is view the running Django app with a web browser.</p>
<div class="highlight"><pre><span></span>$ sudo service nginx restart

$ sudo service nginx status
 nginx.service - A high performance web server and a reverse proxy server
   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
   Active: active (running)
</pre></div>


<h2 id="view-site-at-django-app-with-a-web-browser">View site at Django app with a web browser</h2>
<p>Once everything works, browse to the IP address of the AWS instance. The IP address should be something like:</p>
<blockquote>
<p>http://35.215.335.124/</p>
</blockquote>
<p>You should see the following:</p>
<p><img alt="Django app running" src="#"></p>
<p>The Django App is now running on AWS.</p>
<h2 id="why-this-is-not-a-permenent-solution">Why this is not a permenent solution</h2>
<p>This deployment is not a permenent solution. The <strong>BIG</strong> reason we can't run the Django App in this state is security. </p>
<p>As it stands we don't have SSL running and we are allowing connections over regular http. We should only be using https.</p>
<p><img alt="Django Admin Login Screen" src="#"></p>
<p>In addition, the Django admin is running and it may be possible for attackers to access our database or backend. Further development is needed before our Django App is running with the bare minimum of security.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="../how-to-install-pytesseract.html">How to install pytesseract</a></li>
        <li><a href="../how-to-install-micropython-on-an-esp32.html">How to install MicroPython on an ESP32 microcontroller</a></li>
        <li><a href="../python-arduino-potentiometer.html">Using Python and an Arduino to Read a Sensor</a></li>
        <li><a href="../how-to-make-y-y-plots-with-matplotlib.html">How to make y-y plots with Matplotlib</a></li>
        <li><a href="../stream-S01-E01-jupyterhub-intro.html">My first Twitch Stream: S01-E01 JupyterHub Intro and Tools</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
    </div>
    <!-- AddThis Button END -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="../extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="../how-to-install-pytesseract.html">How to install pytesseract</a></li>
    <li class="list-group-item"><a href="../how-to-install-micropython-on-an-esp32.html">How to install MicroPython on an ESP32 microcontroller</a></li>
    <li class="list-group-item"><a href="../python-arduino-potentiometer.html">Using Python and an Arduino to Read a Sensor</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="../"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-2">
      <a href="../tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../tag/flask.html">flask</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="../tag/jupyter-notebook.html">jupyter notebook</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../tag/matplotlib.html">matplotlib</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="../tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="../tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="../tag/sensor.html">sensor</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="../theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../theme/js/respond.min.js"></script>

    <script src="../static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '../theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="../theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cdd8eb4e16bf94c"></script>
</body>
</html>