<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Oregon Engineering College Transfer App - Part 6: Custom User Model - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

    /*some stuff for output/input prompts*/
    div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
    div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
    div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
    div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
    @media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
    div.prompt:empty{padding-top:0;padding-bottom:0}
    div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
    div.inner_cell{width:90%;}
    div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
    div.input_prompt{color:navy;border-top:1px solid transparent;}
    div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
    div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
    div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
    div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
    div.output_prompt{color:darkred;}
    
    a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
    h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
    /* end stuff for output/input prompts*/
    
    
    .highlight-ipynb .hll { background-color: #ffffcc }
    .highlight-ipynb  { background: #f8f8f8; }
    .highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
    .highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
    .highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
    .highlight-ipynb .o { color: #666666 } /* Operator */
    .highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
    .highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
    .highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
    .highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
    .highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
    .highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
    .highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
    .highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
    .highlight-ipynb .go { color: #888888 } /* Generic.Output */
    .highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
    .highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
    .highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
    .highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
    .highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
    .highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
    .highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
    .highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
    .highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
    .highlight-ipynb .m { color: #666666 } /* Literal.Number */
    .highlight-ipynb .s { color: #BA2121 } /* Literal.String */
    .highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
    .highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
    .highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
    .highlight-ipynb .no { color: #880000 } /* Name.Constant */
    .highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
    .highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
    .highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
    .highlight-ipynb .nf { color: #0000FF } /* Name.Function */
    .highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
    .highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
    .highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
    .highlight-ipynb .nv { color: #19177C } /* Name.Variable */
    .highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
    .highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
    .highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
    .highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
    .highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
    .highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
    .highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
    .highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
    .highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
    .highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
    .highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
    .highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
    .highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
    .highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
    .highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
    .highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
    .highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
    .highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
    .highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
    .highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
    .highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
    .highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
    
    <style type="text/css">
    /* Overrides of notebook CSS for static HTML export */
    div.entry-content {
      overflow: visible;
      padding: 8px;
    }
    .input_area {
      padding: 0.2em;
    }
    
    a.heading-anchor {
     white-space: normal;
    }
    
    .rendered_html
    code {
     font-size: .8em;
    }
    
    pre.ipynb {
      color: black;
      background: #f7f7f7;
      border: none;
      box-shadow: none;
      margin-bottom: 0;
      padding: 0;
      margin: 0px;
      font-size: 13px;
    }
    
    /* remove the prompt div from text cells */
    div.text_cell .prompt {
        display: none;
    }
    
    /* remove horizontal padding from text cells, */
    /* so it aligns with outer body text */
    div.text_cell_render {
        padding: 0.5em 0em;
    }
    
    img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
    
    div.collapseheader {
        width=100%;
        padding: 2px;
        cursor: pointer;
        font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
    }
    
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
    <script type="text/javascript">
    init_mathjax = function() {
        if (window.MathJax) {
            // MathJax loaded
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                },
                displayAlign: 'center', // Change this to 'center' to center equations.
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 0}}
                }
            });
            MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    
    <link href="../extra/favicon.ico" rel="icon">

<link rel="canonical" href="../drafts/oregon-engineering-college-transfer-app-part-6-custom-user-model.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="python,django,web app" />
        <meta name="description" content="This is the 6th part of a multi-part series on building a web app with Python and Django. The web app will act as a resource for Engineering students at Oregon Community Colleges who want to transfer to 4-year Universities. The transfer web app will show which classes from their Community College Engineering program will transfer to which classes in a 4-year University Engineering program. In this 6th post, we&#39;ll build a user model that will allow us to add new users, allow users to login, and allow users to logout. We&#39;ll test this user model with the Django admin." />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Oregon Engineering College Transfer App - Part 6: Custom User Model"/>
        <meta property="og:url" content="../drafts/oregon-engineering-college-transfer-app-part-6-custom-user-model.html"/>
        <meta property="og:description" content="This is the 6th part of a multi-part series on building a web app with Python and Django. The web app will act as a resource for Engineering students at Oregon Community Colleges who want to transfer to 4-year Universities. The transfer web app will show which classes from their Community College Engineering program will transfer to which classes in a 4-year University Engineering program. In this 6th post, we&#39;ll build a user model that will allow us to add new users, allow users to login, and allow users to logout. We&#39;ll test this user model with the Django admin."/>
        <meta property="article:published_time" content="2021-08-25" />
            <meta property="article:section" content="django" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="django" />
            <meta property="article:tag" content="web app" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="../theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../theme/css/pygments/native.css" rel="stylesheet">
    <link href="../theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="../theme/css/style.css" type="text/css"/>
        <link href="../static/css/custom.css" rel="stylesheet">



</head>
<body>

<!-- .navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="../pages/about.html">
                             About
                          </a></li>
                         <li><a href="../pages/book.html">
                             Book
                          </a></li>
                         <li><a href="../pages/gear.html">
                             Gear
                          </a></li>
                         <li><a href="../pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">

<!-- .navbar-search -->
<li>
    <span>
        <form class="navbar-search" action="/search.html">
            <input type="text" name="q" id="tipue_search_input">
        </form>
    </span>
</li>
<!-- /.navbar-search -->              <li><a href="../archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href=".." title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="../category/django.html" title="django">django</a></li>
                <li class="active">Oregon Engineering College Transfer App - Part 6: Custom User Model</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../drafts/oregon-engineering-college-transfer-app-part-6-custom-user-model.html"
                       rel="bookmark"
                       title="Permalink to Oregon Engineering College Transfer App - Part 6: Custom User Model">
                        Oregon Engineering College Transfer App - Part 6: Custom User Model
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2021-08-25T12:40:00-07:00"> Wed 25 August 2021</time>
    </span>

            <span class="label label-default">Series</span>
            Part <built-in method index of str object at 0x0000025301C92030> of 




<span class="label label-default">Tags</span>
	<a href="../tag/python.html">python</a>
        /
	<a href="../tag/django.html">django</a>
        /
	<a href="../tag/web-app.html">web app</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This is the 6<sup>th</sup> part of a multi-part series on building a web app with Python and Django. The web app will act as a resource for Engineering students at Oregon Community Colleges who want to transfer to 4-year Universities. The transfer web app will show which classes from their Community College Engineering program will transfer to which classes in a 4-year University Engineering program. In this 6<sup>th</sup> post, we'll build a user model that will allow us to add new users, allow users to login, and allow users to logout. We'll test this user model with the Django admin.</p>
<div class="toc"><span class="toctitle">Table of contents:</span><ul>
<li><a href="#what-is-a-user-model">What is a user model?</a></li>
<li><a href="#why-do-we-need-to-do-this-now">Why do we need to do this now?</a></li>
<li><a href="#what-do-users-need-to-be-able-to-do">What do users need to be able to do?</a><ul>
<li><a href="#transfer-app-site-privileges">Transfer App site privileges</a></li>
<li><a href="#transfer-app-user-actions">Transfer App user actions</a></li>
</ul>
</li>
<li><a href="#create-the-accounts-app">Create the accounts app</a></li>
<li><a href="#create-a-user-model">Create a user model</a><ul>
<li><a href="#add-the-accounts-app-to-list-of-installed-apps">Add the accounts app to list of installed apps</a></li>
<li><a href="#create-a-custom-users-model-in-the-accounts-app">Create a custom users model in the accounts app</a></li>
</ul>
</li>
<li><a href="#create-a-users-form-in-usersformspy">Create a users form in users/forms.py</a></li>
<li><a href="#add-user-creation-and-user-change-forms-to-the-django-admin">Add user creation and user change forms to the Django admin</a></li>
<li><a href="#make-migrations-and-migrate">Make migrations and migrate</a></li>
<li><a href="#run-the-development-server-and-login">Run the development server and login</a></li>
<li><a href="#use-django-allauth-to-log-in-with-email-and-not-useranme">Use django-allauth to log in with email and not useranme</a><ul>
<li><a href="#install-django-allauth">Install django-allauth</a></li>
<li><a href="#update-requirementstxt">Update requirements.txt</a></li>
<li><a href="#update-settingspy">Update settings.py</a></li>
<li><a href="#add-djano-allauth-settings-to-settingspy">Add djano-allauth settings to settings.py</a></li>
<li><a href="#migrate-the-database">Migrate the database</a></li>
<li><a href="#add-an-accounts-path-to-project-urls">Add an accounts path to project urls</a></li>
<li><a href="#modify-the-login-and-signup-templates">Modify the login and signup templates</a></li>
<li><a href="#add-a-login-and-signup-redirect-to-the-homepage">Add a login and signup redirect to the homepage</a></li>
<li><a href="#restart-the-develpment-server">Restart the develpment server</a></li>
</ul>
</li>
<li><a href="#push-code-up-to-github">Push code up to GitHub</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#future-work">Future Work</a></li>
</ul>
</div>
<h2 id="what-is-a-user-model">What is a user model?</h2>
<p>The Oregon Transfer App has two purposes. The first purpose is to be a website that Community College students can use to see which classes at their Community College transfer to a specific 4-year University in Oregon. The second purpose is to be a place where administrators at 4-year Universities can post transfer class equivalencies. The 4-year University administrators <em>set</em> which classes transfer, and the students <em>see</em> which classes transfer. We need to build a user model so that the 4-year university administrators can login, then build and modify transfer equavalencies. Students (or any other user) will not have to login to see which classes transfer. Students (or any other regular user) will not have the ability to <em>set</em> which classes transfer, just <em>see</em> which classes transfer. So a user model for the 4-year University administrators is needed.</p>
<h2 id="why-do-we-need-to-do-this-now">Why do we need to do this now?</h2>
<p>The purpose of the website is to show which classes transfer, but we haven't even entired one class into the site yet. Why build a custom user model first? </p>
<p>We want to create the custom user model first because when we add a courses model to the site, we will have to migrate the database. If the database is migrated before we create a custom user model, changing the default usermodel is going to be a big pain. So it's better to create the custom user model before we create any other databse related things on our site. After the custom user model is set up, we can migrate the database and then move on to building a courses model.</p>
<h2 id="what-do-users-need-to-be-able-to-do">What do users need to be able to do?</h2>
<p>The 4-year University administrators need to be able to do a couple things:</p>
<h3 id="transfer-app-site-privileges">Transfer App site privileges</h3>
<ul>
<li>log into the Transfer App Admin backend</li>
<li>Create and edit classes at their college</li>
<li>Create and edit which Community College classes are equivalent to which University classes at their college</li>
</ul>
<h3 id="transfer-app-user-actions">Transfer App user actions</h3>
<ul>
<li>Create a new user, set username and password</li>
<li>Log in</li>
<li>Log out</li>
<li>Reset password</li>
<li>Retrieve forgetten password</li>
<li>Maybe set and update a profile?</li>
</ul>
<p>We'll build some of these actions into our custom user model.</p>
<h2 id="create-the-accounts-app">Create the accounts app</h2>
<p>At the Anaconda Prompt activate the <code>(transfer)</code> virtual environment and run the <code>startapp</code> command to create a new Django app called <code>accounts</code> in our Django project. We already have a <strong>pages</strong> app in our project. Now we need to add an <strong>accounts</strong> app to the project.</p>
<div class="highlight"><pre><span></span>&gt; cd Documents
&gt; cd tranfer
# make sure you are in the project base directory
&gt; conda activate transfer
(transfer) &gt; python manage.py startapp accounts
</pre></div>


<p>This will create a new <code>accounts</code> directory in our project and populate the <code>accounts</code> directory with a couple files.</p>
<div class="highlight"><pre><span></span>└───accounts
    │   admin.py
    │   apps.py
    │   models.py
    │   tests.py
    │   views.py
    │   __init__.py
    │
    └───migrations
            __init__.py
</pre></div>


<h2 id="create-a-user-model">Create a user model</h2>
<p>There are a couple steps needed to get our custom user model working. We need to update the project <code>settings.py</code> file so that our accounts app is included in the list of install apps. Then we'll create the user model in our accounts app. I learned about custom user models from Will Vincent's excellent Learn Django site and Matt Herman's TestDriven.io site. Links for these resources are below.</p>
<p><a href="https://learndjango.com/tutorials/django-custom-user-model">LearnDjango - Django Best Practices: Custom User Model</a></p>
<p><a href="https://learndjango.com/tutorials/django-log-in-email-not-username">LearnDjango - Django Log In with Email not Username</a></p>
<p><a href="https://testdriven.io/blog/django-custom-user-model/">testdriven.io - Creating a Custom User Model in Django</a></p>
<h3 id="add-the-accounts-app-to-list-of-installed-apps">Add the accounts app to list of installed apps</h3>
<p>Now we'll add our accounts app to the list of installed apps. To do this, we need to edit the <code>settings.py</code> file in the overall <code>transfer_project</code> folder.</p>
<div class="highlight"><pre><span></span><span class="c1"># transfer_project/settings.py</span>
<span class="o">...</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.contenttypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.sessions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.messages&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.staticfiles&quot;</span><span class="p">,</span>

    <span class="c1"># project specific</span>
    <span class="s2">&quot;pages.apps.PagesConfig&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>


<p>Also define the <code>AUTH_USER_MODEL</code> in the same <code>settings.py</code> file.</p>
<div class="highlight"><pre><span></span><span class="c1"># transfer_project/settings.py</span>
<span class="o">...</span>

<span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s1">&#39;users.CustomUser&#39;</span>
</pre></div>


<h3 id="create-a-custom-users-model-in-the-accounts-app">Create a custom users model in the accounts app</h3>
<p>Now we need to create our custom users model in the accounts app.  Add a new <code>CustomUser</code> class derived from the <code>AbstractUser</code> base class in the <code>users/models.py</code> file</p>
<div class="highlight"><pre><span></span><span class="c1"># accounts/models.py</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">AbstractUser</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">CustomUser</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span>
</pre></div>


<h2 id="create-a-users-form-in-usersformspy">Create a users form in users/forms.py</h2>
<p>Now we need to create a new form in the accounts app. Create a new file called <code>forms.py</code> in the <code>accounts/</code> directory. This form will allow new users to be created and exiting users to make changes the their accounts.</p>
<div class="highlight"><pre><span></span><span class="c1"># accounts/forms.py</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span><span class="p">,</span> <span class="n">UserChangeForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">CustomUser</span>

<span class="k">class</span> <span class="nc">CustomUserCreationForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">CustomUser</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CustomUserChangeForm</span><span class="p">(</span><span class="n">UserChangeForm</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">CustomUser</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="add-user-creation-and-user-change-forms-to-the-django-admin">Add user creation and user change forms to the Django admin</h2>
<p>In order to use the Django admin to add and modify users, we need to add our user creation form and add our user change form to the <code>accounts/admin.py</code> file.</p>
<div class="highlight"><pre><span></span><span class="c1"># accounts/admin.py</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.admin</span> <span class="kn">import</span> <span class="n">UserAdmin</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomUserCreationForm</span><span class="p">,</span> <span class="n">CustomUserChangeForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">CustomUser</span>

<span class="k">class</span> <span class="nc">CustomUserAdmin</span><span class="p">(</span><span class="n">UserAdmin</span><span class="p">):</span>
    <span class="n">add_form</span> <span class="o">=</span> <span class="n">CustomUserCreationForm</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">CustomUserChangeForm</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CustomUser</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,]</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">CustomUser</span><span class="p">,</span> <span class="n">CustomUserAdmin</span><span class="p">)</span>
</pre></div>


<h2 id="make-migrations-and-migrate">Make migrations and migrate</h2>
<p>We made changes to the database, so before we start the local server and see if our user model works, we need to <code>makemigrations</code> and <code>migrate</code> the database changes. This should be the first time we migrate the database. If the database is migrated before creating the custom user model, it is hard to change the user model later.</p>
<div class="highlight"><pre><span></span>(transfer)&gt; python manage.py makemigrations accounts
(transfer)&gt; python manage.py migrate
</pre></div>


<p>After the database is set up, we can create a super user account from the command line.</p>
<div class="highlight"><pre><span></span>(transfer)&gt; python manage.py createsuperuser
</pre></div>


<p>The command line will prompt you to create a new user and enter their email address, something like below.</p>
<div class="highlight"><pre><span></span>Username: peter
Email address: peter@peter.com
Password: 
Password (again):
The password is too similar to the username.
This password is too short. It must contain at least 8 characters.
This password is too common.
Bypass password validation and create user anyway? [y/N]: y
Superuser created successfully.
</pre></div>


<h2 id="run-the-development-server-and-login">Run the development server and login</h2>
<p>Now that our custom user model is set up, we can use the Django admin to log into our website.</p>
<p><strong>MAKE SURE YOU LOG OUT BEFORE CONTINUING</strong></p>
<div class="highlight"><pre><span></span>(transfer) &gt; python manage.py runserver
</pre></div>


<p>browse to:</p>
<blockquote>
<p>http://localhost:8000/admin/</p>
</blockquote>
<p><strong>MAKE SURE YOU LOG OUT BEFORE CONTINUING</strong></p>
<p>The Django admin looks something like below. Log in with the new superuser username and password that we just set up.</p>
<p><img alt="Django admin login" src="../posts/transfer_app/images/django_admin_login.png"></p>
<p>After logging in with the superuser credentials, the Django admin dashboard pops up.</p>
<p><img alt="Django admin dashboard" src="../posts/transfer_app/images/django_admin_dashboard.png"></p>
<p><strong>DID YOU LOG OUT OF THE DJANGO ADMIN? MAKE SURE YOU LOG OUT BEFORE YOU STOP THE SERVER</strong></p>
<p>Next, we are going to use the django-allauth package to allow us to log into the site with an email address instead of a username.</p>
<h2 id="use-django-allauth-to-log-in-with-email-and-not-useranme">Use django-allauth to log in with email and not useranme</h2>
<h3 id="install-django-allauth">Install django-allauth</h3>
<div class="highlight"><pre><span></span>(transfer) &gt; python -m pip install django-allauth==0.45.0
</pre></div>


<h3 id="update-requirementstxt">Update requirements.txt</h3>
<div class="highlight"><pre><span></span>python -m pip freeze &gt; requirements.txt
</pre></div>


<h3 id="update-settingspy">Update settings.py</h3>
<div class="highlight"><pre><span></span><span class="c1"># transfer_project/settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.contenttypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.sessions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.messages&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.staticfiles&quot;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sites&#39;</span><span class="p">,</span>

    <span class="c1"># 3rd party</span>
    <span class="s1">&#39;allauth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;allauth.account&#39;</span><span class="p">,</span>
    <span class="s1">&#39;allauth.socialaccount&#39;</span><span class="p">,</span>

    <span class="c1"># project specific</span>
    <span class="s2">&quot;pages.apps.PagesConfig&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>


<h3 id="add-djano-allauth-settings-to-settingspy">Add djano-allauth settings to settings.py</h3>
<div class="highlight"><pre><span></span><span class="n">transfer_project</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>

<span class="c1"># django-allauth settings</span>
<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.console.EmailBackend&#39;</span>

<span class="n">AUTHENTICATION_BACKENDS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># Needed to login by username in the Django admin, regardless of djagno-allauth</span>
    <span class="s2">&quot;django.contrib.auth.backends.ModelBackend&quot;</span><span class="p">,</span>

    <span class="c1"># django-allauth specific authentication methods, like login by e-mail</span>
    <span class="s2">&quot;allauth.account.auth_backends.AuthenticationBackend&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">ACCOUNT_EMAIL_REQUIRED</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">ACCOUNT_USERNAME_REQUIRED</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">ACCOUNT_SIGNUP_PASSWORD_ENTER_TWICE</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">ACCOUNT_SESSION_REMEMBER</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">ACCOUNT_AUTHENTICATION_METHOD</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span>
<span class="n">ACCOUNT_UNIQUE_EMAIL</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<h3 id="migrate-the-database">Migrate the database</h3>
<p>We added a new app to our django project (django-allauth). Each time a new app is added, the database needs to be migrated.</p>
<div class="highlight"><pre><span></span>(transfer) &gt; python manage.py makemigrations
(transfer) &gt; python manage.py migrate
</pre></div>


<h3 id="add-an-accounts-path-to-project-urls">Add an accounts path to project urls</h3>
<p>Point the path <code>/accounts/</code> to allath.urls in the project <code>urls.py</code> file.</p>
<div class="highlight"><pre><span></span><span class="c1"># transfer_project/urls.py</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;admin/&quot;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;accounts/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;allauth.urls&#39;</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;pages.urls&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>


<h3 id="modify-the-login-and-signup-templates">Modify the login and signup templates</h3>
<p>We are going to customize the login and signup tempates. Create a new <code>accounts/</code> directory in the <code>templates/</code> directory. Inside <code>accounts/</code> create a <code>login.html</code> template and a <code>signup.html</code> template. </p>
<div class="highlight"><pre><span></span><span class="c">&lt;!-- templates/account/login.html --&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Log In<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
  {% csrf_token %}
  {{ form.as_p }}
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Log In<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">&lt;!-- templates/account/signup.html --&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Sign Up<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
  {% csrf_token %}
  {{ form.as_p }}
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Sign Up<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>


<h3 id="add-a-login-and-signup-redirect-to-the-homepage">Add a login and signup redirect to the homepage</h3>
<div class="highlight"><pre><span></span><span class="n">transfer_project</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;home&#39;</span>
<span class="n">ACCOUNT_LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;home&#39;</span>
</pre></div>


<h3 id="restart-the-develpment-server">Restart the develpment server</h3>
<p>Restart the development server and see the new pages in action.</p>
<div class="highlight"><pre><span></span>(transfer) &gt; python manage.py runserver
</pre></div>


<h2 id="push-code-up-to-github">Push code up to GitHub</h2>
<div class="highlight"><pre><span></span>(transfer) &gt; isort .
(transfer) &gt; black .
(transfer) &gt; git add .
(transfer) &gt; git commit -m &quot;commit message&quot;
(transfer) &gt; git push origin main
</pre></div>


<h2 id="summary">Summary</h2>
<p>That was a ton of work, but we got the new user model working. We created the accounts app, added a custom user model to the acconts app and then incorporated the user model into the Django admin. Then we ran the Django admin and created a new user. Finally we used the django-allauth package to log into our website using an email address.</p>
<h2 id="future-work">Future Work</h2>
<p>Next, we'll create a college model so that we will be able to add colleges to the site. Our project is really moving along now.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="../add-inset-curve-to-matplotlib-plot.html">How to add an Inset Curve with Matplotlib and Python</a></li>
        <li><a href="../crank-and-rocker-motion-with-python-and-matplotlib.html">Crank and Rocker Motion with Python and Matplotlib</a></li>
        <li><a href="../what-is-ansible.html">What is Ansible?</a></li>
        <li><a href="../git-and-github-for-undergrad-engineers.html">Git and GitHub for Undergrad Engineers</a></li>
        <li><a href="../live-plotting-with-matplotlib.html">How to make animated plots with Matplotlib and Python</a></li>
    </ul>
</section>
<section class="well" id="related-posts">
    <h4>Article <built-in method index of str object at 0x0000025301C92030> of the  series</h4>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
    </div>
    <!-- AddThis Button END -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Ethical Ads -->
<div class="horizontal" data-ea-publisher="pythonforundergradengineers-com" data-ea-type="image"></div>
<!-- end Ethical Ads --><div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="../extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="../add-inset-curve-to-matplotlib-plot.html">How to add an Inset Curve with Matplotlib and Python</a></li>
    <li class="list-group-item"><a href="../crank-and-rocker-motion-with-python-and-matplotlib.html">Crank and Rocker Motion with Python and Matplotlib</a></li>
    <li class="list-group-item"><a href="../what-is-ansible.html">What is Ansible?</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="../"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-2">
      <a href="../tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../tag/flask.html">flask</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="../tag/jupyter-notebook.html">jupyter notebook</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../tag/matplotlib.html">matplotlib</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="../tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="../tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="../tag/sensor.html">sensor</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Series -->
<li class="list-group-item">
  <h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Series</span></h4>
  <ul class="list-group">
  </ul>
</li>
<!-- End Sidebar/Series -->


<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="../theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../theme/js/respond.min.js"></script>

    <script src="../static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '../theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="../theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
<!-- Ethical Ads JS-->
<script async src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
<!-- end Ethical Ads JS -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cdd8eb4e16bf94c"></script>
</body>
</html>