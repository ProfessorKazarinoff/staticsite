<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Building Micropython Firmware for Two Dollar ESP8266-01 Modules - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}

</style>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'center', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
    <link href="/extra/favicon.ico" rel="icon">

<link rel="canonical" href="/drafts/building-mircopython-firmware.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="python,micropython,esp8266,microcontroller,firmware" />
        <meta name="description" content="This is the eighth part of a multipart series on Micropython. In this last post of the series, we will uploaded Micropython on a cheap $3 ESP8266-01 board. In this post we will journey down the rabbit hole of building custom firmware for the ESP-01 boards." />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Building Micropython Firmware for Two Dollar ESP8266-01 Modules"/>
        <meta property="og:url" content="/drafts/building-mircopython-firmware.html"/>
        <meta property="og:description" content="This is the eighth part of a multipart series on Micropython. In this last post of the series, we will uploaded Micropython on a cheap $3 ESP8266-01 board. In this post we will journey down the rabbit hole of building custom firmware for the ESP-01 boards."/>
        <meta property="article:published_time" content="2018-07-29" />
            <meta property="article:section" content="micropython" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="micropython" />
            <meta property="article:tag" content="esp8266" />
            <meta property="article:tag" content="microcontroller" />
            <meta property="article:tag" content="firmware" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link href="/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/css/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="/pages/about.html">
                             About
                          </a></li>
                         <li><a href="/pages/book.html">
                             Book
                          </a></li>
                         <li><a href="/pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="" title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="/category/micropython.html" title="micropython">micropython</a></li>
                <li class="active">Building Micropython Firmware for Two Dollar ESP8266-01 Modules</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/drafts/building-mircopython-firmware.html"
                       rel="bookmark"
                       title="Permalink to Building Micropython Firmware for Two Dollar ESP8266-01 Modules">
                        Building Micropython Firmware for Two Dollar ESP8266-01 Modules
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-07-29T09:01:00-07:00"> Sun 29 July 2018</time>
    </span>

            <span class="label label-default">Series</span>
            Part <built-in method index of str object at 0x000002D0466BC3F0> of 




<span class="label label-default">Tags</span>
	<a href="/tag/python.html">python</a>
        /
	<a href="/tag/micropython.html">micropython</a>
        /
	<a href="/tag/esp8266.html">esp8266</a>
        /
	<a href="/tag/microcontroller.html">microcontroller</a>
        /
	<a href="/tag/firmware.html">firmware</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This is the eighth part of a multipart series on Micropython. In this last post of the series, we will uploaded Micropython on a cheap $3 ESP8266-01 board with only 1 MB of flash memory. It is pretty amazing that even these inexpensive boards can run Micropython. Although the small ESP-01 can run Micropython, The problem is I wasn't able to load any code (upload any <strong><em>.py</em></strong> files) onto little ESP-01 board. The Micropython REPL worked, but when the board was restarted all the code typed in was erased. This brought me down the rabbit hole of building custom firmware for the ESP-01 board. </p>
<p>Getting Micropython onto the little ESP-01 board with only 1 MB of flash memory was really cool. It is amazing that such a small, cheap piece of hardware can run Python. The problem is that if I want to turn the ESP-01 into something useful, it has to have a Python program running on it. The REPL worked great. But when I tried to use <strong>ampy</strong> to upload a <strong><em>.py</em></strong> file onto it, the terminal just spit out an error. After watching a couple YouTube videos on pushing Micropython to Adafruit boards, I think the only way to get a <strong><em>.py</em></strong> file on the ESP-01 is to have the <strong><em>.py</em></strong> file baked into the firmware. How hard can that be? Pretty hard actually. Building custom firmware is kind of a daunting task. Here's how I finally got it to work.</p>
<p>Summary of Steps:</p>
<ol>
<li>Go to the den and use the Linux Desktop running Ubuntu 16.04</li>
<li>Install the ESP Open SDK</li>
<li>Build the Micropython firmware</li>
<li>Upload the firmware to the ESP-01</li>
<li>Test out the Micropython REPL</li>
<li>A neat buried function in the Micropython firmware</li>
</ol>
<h3 id="1-go-to-the-den-and-use-the-linux-desktop-running-ubuntu-1604">1. Go to the den and use the Linux Desktop running Ubuntu 16.04</h3>
<p>I initially tried to building the Micropython firmware for the ESP-01 board in a Virtual Machine (a VM) running on a Windows 10 laptop. A Virtual Machine is like a computer running inside another computer. The Virtual Machine was created using Vagrant. Getting the VM up and running went fine. Cloning the github repo inside the VM worked great. But building the ESP SDK just wouldn't work. I kept getting errors and the build never completed. I have an actual Linux computer running Ubuntu 16.04 in my den, so after messing around with the VM running in Windows 10 for a couple hours, I decided to just use an actual Linux computer.</p>
<h3 id="2-install-the-esp-open-sdk">2. Install the ESP Open SDK</h3>
<p>In order to build the Micropython firmware for the ESP-01. First I needed to build and install the ESP Open SDK. </p>
<p>According to the <a href="https://github.com/micropython/micropython/tree/master/ports/esp8266">Micropython docs</a>:</p>
<blockquote>
<p>The tool chain required for the build is the OpenSource ESP SDK, which can be found at https://github.com/pfalcon/esp-open-sdk. Clone this repository and run make in its directory to build and install the SDK locally. Make sure to add toolchain bin directory to your PATH. Read esp-open-sdk's README for additional important information on toolchain setup.</p>
</blockquote>
<p>Over on pfalcon's <a href="https://github.com/micropython/micropython/tree/master/ports/esp8266">esp-open-sdk github repo README</a>, a bunch of dependencies need to be installed first before building the ESP SDK.</p>
<div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get upgrade
$ sudo apt-get install make unrar-free autoconf automake libtool gcc g++ gperf 
$ sudo apt-get install flex bison texinfo gawk ncurses-dev libexpat-dev python-dev python python-serial
$ sudo apt-get install sed git unzip bash help2man wget bzip2 libtool-bin autoconf gperf help2man libtool libtool.bin
</pre></div>


<p>Next step was cloning the esp-open-sdk repo and running the <code>make</code> command. I went through a bunch of times trying to run the <code>make</code> command without success. Each time an error popped up, I looked to see if there was some package missing that could be installed with <code>apt-get install</code>. Eventually with all the needed packages installed, the <code>make</code> command ran. The build process took a long time. Over 10 minutes.</p>
<div class="highlight"><pre><span></span>$ git clone --recursive https://github.com/pfalcon/esp-open-sdk.git
$ <span class="nb">cd</span> esp-open-sdk
$ make
</pre></div>


<p>pfalcon notes that the <code>xtensa-lx106-elf/bin/</code> subdirectory needs to be added to your PATH.</p>
<blockquote>
<p>Once you complete build process as described above, the toolchain (with the Xtensa HAL library) will be available in the xtensa-lx106-elf/ subdirectory. Add xtensa-lx106-elf/bin/ subdirectory to your PATH environment variable to execute xtensa-lx106-elf-gcc and other tools. </p>
</blockquote>
<p>Of the differences between Linux and Windows, the one I still have trouble wrapping my head around is messing around with PATH. Each time I need to modify PATH or make something executable from the command line, I have to hit up google and stack overflow. To add the xtensa subdirectory PATH, I used the following commands:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s1">&#39;export PATH=$PATH:/home/peter/esp-open-sdk/xtensa-lx106-elf/bin/&#39;</span> &gt;&gt; ~/.bashrc
$ <span class="nb">source</span> ~/.bashrc
</pre></div>


<h3 id="3-build-the-micropython-firmware">3. Build the Micropython firmware</h3>
<p>With the esp-open-sdk installed, it's time to clone the main Micropython repo and build the ESP8266 firmware. Some more terminal commands did the trick.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~
$ git clone git@github.com:micropython/micropython.git
$ git submodule update --init
$ <span class="nb">cd</span> micropython
</pre></div>


<p>Once the whole Micropython repo is cloned locally, the mpy-cross tool needs to be built and then you can jump into the ESP8266 port and build the firmware.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/micropython
$ make -C mpy-cross
$ <span class="nb">cd</span> ports/esp8266
<span class="c1"># if building firmware for the second time run $ make clean</span>
$ make axtls
$ make
</pre></div>


<p>According to the Micropython docs, the resulting firmware file will be in the <code>/build</code> directory.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">pwd</span>
~/micropython/ports/esp8266
$ <span class="nb">cd</span> build
$ ls
</pre></div>


<p>The file to look for is <strong><em>firmware-combined.bin</em></strong>. There will be a lot of files in the build directory, but this is the one we need to upload on the ESP-01 board. </p>
<h3 id="4-upload-the-firmware-to-the-esp-01">4. Upload the firmware to the ESP-01</h3>
<p>First the ESP-01 needs to be wired up in bootloader mode. Once connected to USB through and FTDI addapter and wired up in bootloader mode the ESP-01 flash can be erased.</p>
<div class="highlight"><pre><span></span>$ esptool.py --port /dev/ttyUSB0 erase_flash
</pre></div>


<p>With the flash memory erased, the firmware can be uploaded. You need to be in the same directory as the firmware-combined.bin file for the command to work.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/micropython/ports/esp8266/build
$ esptool.py --port /dev/ttyUSB0 --baud <span class="m">115200</span> write_flash --flash_size<span class="o">=</span>detect <span class="m">0</span> firmware-combined.bin
</pre></div>


<h3 id="5-test-out-the-micropython-repl">5. Test out the Micropython REPL</h3>
<p>After putting the ESP-01 back into regular running mode, connect the ESP-01 to the Linux computer with the FTDI cable. Try logging in with the screen utility and running a couple commands. The default baud rate that Micropython uses is 115200.</p>
<div class="highlight"><pre><span></span>$ screen /dev/ttyUSB0 115200
# [ctrl-c] to reset
&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.platform
&#39;esp8266&#39;
&gt;&gt;&gt; sys.implementation
(name=&#39;micropython&#39;, version=(1, 9, 3))
</pre></div>


<h3 id="6-a-neat-buried-function-in-the-micropython-firmware">6. A neat buried function in the Micropython firmware</h3>
<p>Initally, I couldn't figure out how much flash memory my little ESP-01 board had. I assumed it had 512 kB of flash memory. After having trouble building the special 512 kB firmware, and having no luck, I accidentally uploaded the full Micropython firmware (the firmware designed for 4 MB flash modules (like the ESP-12 on the Adafruit Feather Huzzah and nodeMCU boards) onto the little ESP-01. But the large firmware file uploaded fine, and the REPL started and worked!? Huh... I though that the full size firmware wouldn't fit on the little ESP-01 board, but it actually did. I was digging through the <code>~/micropython/ports/esp8266/modules</code> directory and found a couple <strong><em>.py</em></strong> files. The <strong><em>.py</em></strong> files should be built into the firmware. At the Micropython REPL I tried a couple different module imports.</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; import ntptime
&gt;&gt;&gt; dir(ntptime)
&gt;&gt;&gt; import dht
&gt;&gt;&gt; dir(dht)
</pre></div>


<p>All of the modules imported fine on the little ESP-01 board. There was one <strong><em>.py</em></strong> file in the module folder called <strong><em>port_diag.py</em></strong> The output from the import was pretty interesting:</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; import port_diag
#All the stuff
</pre></div>


<p>It looks like my little ESP-01 board actually has 1 MB of flash memory, not 512 kB, as I assumed. Great! This means that the full Micropython firmware will fit. The  <code>import port_diag</code> call also shows how big the firmware file is. For my custom firmware, the total was 578255. I think that means 578225 bytes which is 578 kB or a little over half a MB. With 1 MB of flash memory on my little ESP-01 board, that's over half of the flash memory taken up. But it the full firmware does actually upload and run.</p>
<p>So now the next task will be paring down the firmware build so that we still have the full Micropython firmware, but leave out the modules we don't need (like the temperature sensor or Neopixel modules) and put in some custom modules we do want like a WiFi tools module and a ThingSpeak.com module. This should be as simple as modifying which files are in <code>~/micropython/ports/esp8266/modules</code> and running <code>$ make clean</code> and <code>$ make</code> to output a custom firmware <strong><em>.bin</em></strong> file. Any <strong><em>.py</em></strong> file in the <code>/modules</code> subdirectory will make it into the firmware when it gets built.</p>
<p>I also want to make sure there is enough room left for the regular Micropython file system, because I want to upload a main.py file using <strong>ampy</strong> that will run on the little ESP-01 board as soon as it powers up. I'm also going to have to figure out a way to parse the junk that comes out when I do an http GET request from ThingSpeak. There is a lot of header junk that I don't want.</p>
<p>Save those for next time...</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="/micropython-upload-code.html">Upload Micropython Code to an Adafruit Feather Huzzah ESP8266</a></li>
        <li><a href="/micropython-wifi.html">Using Micropython to connect an Adafruit Feather Huzzah ESP8266 to WiFi</a></li>
        <li><a href="/micropython-temp-sensor.html">Using a Temperature Sensor with Micropython running on an Adafruit Feather Huzzah ESP8266</a></li>
        <li><a href="/micropython-install.html">Installing Micropython on an Adafruit Feather Huzzah ESP8266</a></li>
        <li><a href="/what-is-micropython.html">What is Micropython?</a></li>
    </ul>
</section>
<section class="well" id="related-posts">
    <h4>Article <built-in method index of str object at 0x000002D0466BC3F0> of the  series</h4>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="/extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, MATLAB and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="/flask-app-on-digital-ocean.html">Building a single page Flask App on Digital Ocean</a></li>
    <li class="list-group-item"><a href="/micropython-upload-code.html">Upload Micropython Code to an Adafruit Feather Huzzah ESP8266</a></li>
    <li class="list-group-item"><a href="/micropython-wifi.html">Using Micropython to connect an Adafruit Feather Huzzah ESP8266 to WiFi</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-3">
      <a href="/tag/blog.html">blog</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/esp8266.html">esp8266</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/jupyter-hub.html">jupyter hub</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/jupyter-notebooks.html">jupyter notebooks</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="/tag/python.html">python</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Series -->
<li class="list-group-item">
  <h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Series</span></h4>
  <ul class="list-group">
  </ul>
</li>
<!-- End Sidebar/Series -->


<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <script src="/static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
</body>
</html>