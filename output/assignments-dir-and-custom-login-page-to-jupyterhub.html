<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Add a custom login page and assignments directory for each user on a Jupyter Hub server - Python for Undergraduate Engineers</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}

div.collapseheader {
    width=100%;
    padding: 2px;
    cursor: pointer;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
}

</style>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'center', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
    <link href="/extra/favicon.ico" rel="icon">

<link rel="canonical" href="/assignments-dir-and-custom-login-page-to-jupyterhub.html">

        <meta name="author" content="Peter D. Kazarinoff" />
        <meta name="keywords" content="jupyter,jupyter hub,jupyter notebooks,python" />
        <meta name="description" content="This is the seventh part of a multi-part series that shows how to set up Jupyter Hub for a college class. In this post, we build a pre-spawn hook that creates an &#34;assignments&#34; and &#34;notes&#34; directory with pre-constructed assignments and notes for each jupyterhub user. We also build a custom login pages that looks much more like our college login page and contains helpful links." />

        <meta property="og:site_name" content="Python for Undergraduate Engineers" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Add a custom login page and assignments directory for each user on a Jupyter Hub server"/>
        <meta property="og:url" content="/assignments-dir-and-custom-login-page-to-jupyterhub.html"/>
        <meta property="og:description" content="This is the seventh part of a multi-part series that shows how to set up Jupyter Hub for a college class. In this post, we build a pre-spawn hook that creates an &#34;assignments&#34; and &#34;notes&#34; directory with pre-constructed assignments and notes for each jupyterhub user. We also build a custom login pages that looks much more like our college login page and contains helpful links."/>
        <meta property="article:published_time" content="2018-06-14" />
            <meta property="article:section" content="jupyter" />
            <meta property="article:tag" content="jupyter" />
            <meta property="article:tag" content="jupyter hub" />
            <meta property="article:tag" content="jupyter notebooks" />
            <meta property="article:tag" content="python" />
            <meta property="article:author" content="Peter D. Kazarinoff" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link href="/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/css/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Python for Undergraduate Engineers            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="/pages/about.html">
                             About
                          </a></li>
                         <li><a href="/pages/book.html">
                             Book
                          </a></li>
                         <li><a href="/pages/now.html">
                             Now
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="" title="Python for Undergraduate Engineers"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="/category/jupyter.html" title="jupyter">jupyter</a></li>
                <li class="active">Add a custom login page and assignments directory for each user on a Jupyter Hub server</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/assignments-dir-and-custom-login-page-to-jupyterhub.html"
                       rel="bookmark"
                       title="Permalink to Add a custom login page and assignments directory for each user on a Jupyter Hub server">
                        Add a custom login page and assignments directory for each user on a Jupyter Hub server
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-06-14T10:40:00-07:00"> Thu 14 June 2018</time>
    </span>

            <span class="label label-default">Series</span>
            Part 7 of Jupyter Hub




<span class="label label-default">Tags</span>
	<a href="/tag/jupyter.html">jupyter</a>
        /
	<a href="/tag/jupyter-hub.html">jupyter hub</a>
        /
	<a href="/tag/jupyter-notebooks.html">jupyter notebooks</a>
        /
	<a href="/tag/python.html">python</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This is the seventh part of a multi-part series that shows how to set up Jupyter Hub for a college class. In this post, we build a pre-spawn hook that creates an "assignments" and "notes" directory with pre-constructed assignments and notes for each <strong>jupyterhub</strong> user. We also build a custom login pages that looks much more like our college login page and contains helpful links.</p>
<h3 id="posts-in-this-series">Posts in this series</h3>
<ol>
<li><a href="/why-jupyter-hub.html">Why Jupyter Hub?</a></li>
<li><a href="/ssh-keys-with-putty.html">Create ssh key, save to documents/ssh-keys</a></li>
<li><a href="/new-digital-ocean-droplet.html">Create a new Digital Ocean Droplet with a non-root sudo user</a></li>
<li><a href="/installing-jupyter-hub.html">Install Jupyter Hub on the server</a></li>
<li><a href="/add-ssl-and-domain-name-to-jupyterhub.html">Apply SSL, link a domain name to the server and configure nginx</a></li>
<li><a href="/add-google-oauth-and-system-service-to-jupyterhub.html">Connect OAuth to Jupyter Hub</a></li>
<li><strong>Add a custom login page and assignments directory for each user on a Jupyter Hub server</strong> (this post)</li>
</ol>
<h3 id="last-time">Last time</h3>
<p>In the <a href="/add-google-oauth-and-system-service-to-jupyterhub.html">last post</a>, we set <strong>jupyterhub</strong> to run as a system service in the background on our server. Then we added tried two different login systems: github and google. The github authentication system allowed user to log in with github usernames and passwords. The google authentication system allowed users to log in with their college usernames and passwords. Then we modified the jupyterhub_config.py file to all the creation of new users on the server even if the new usernames contained a dot.</p>
<h3 id="steps-in-this-post">Steps in this post:</h3>
<ol>
<li>Create a repo on github.com with the assignments and notes</li>
<li>Add a pre-spawn hook in jupyterhub_config.py</li>
<li>Create a templates directory and populate it with Jinja templates to create a new login page</li>
<li>Modify the style.min.css file to apply styling to the login page</li>
</ol>
<p><br></p>
<h3 id="1-create-a-repo-on-githubcom-with-the-assignments">1. Create a repo on github.com with the assignments</h3>
<p>On github.com, create a new repo with the notes and assignments for the quarter.</p>
<p><img alt="new repo" src="/images/new_github_repo.png"></p>
<p><img alt="repo details" src="/images/create_a_new_repo_details.png"></p>
<p>On a local computer, not the server, clone the github repo. This allows us to work on the notes and assignments locally.</p>
<div class="highlight"><pre><span></span># local computer
$ mkdir ENGR101
$ cd ENGR101
$ git init
$ git remote add origin https://github.com/ProfessorKazarinoff/ENGR101.git
$ git pull origin master
</pre></div>


<p>On the local computer, not the server, build the assignment and notes for the quarter. I did this using jupyter notebooks. Then add, commit and push the changes up to github.</p>
<div class="highlight"><pre><span></span># local computer
$ git add .
$ commit -m &quot;added assignments and notes&quot;
$ git push origin master
</pre></div>


<p><br></p>
<h3 id="2-add-a-pre-spawn-hook-in-jupyterhub_configpy">2. Add a pre-spawn hook in jupyterhub_config.py</h3>
<p>Now we can go to the server and have the notebooks we created (and pushed up to github) pre-populate each users directory tree when they log into <strong>jupyterhub</strong>.</p>
<p>We'll use a Python package called <strong>gitpython</strong> to help with pulling the notebooks down from github.com. Log into the server and install <strong>gitpython</strong> using <strong>conda</strong>:</p>
<div class="highlight"><pre><span></span># on the server
$ sudo apt-get update
$ conda install -c conda-forge gitpython
</pre></div>


<p>Now we need to modify the jupyterhub_config.py file to do a couple things: Run a pre-spawn hook function that runs before each user's jupyter notebook server is started and pull the assignments and notes down from github as part of the pre-spawn hook function.</p>
<p>The pre-spawn hook function gets called every time a user logs into jupyterhub.  This pre-spawn hook will run before the user's jupyter notebook server is created. In the pre-spawn hook, we want to check to see if the user has the assignments and notes pulled down from github already loaded. If the user doesn't have the assignments, then we want to pull the assignments down from github and put them in the user's directory tree.</p>
<p>So first we need a function that will pull the repo down from github. Note the line <code>uid = getpwnam(user).pw_uid</code> and <code>gid = getpwnam(user).pw_gid</code> in the function below. These lines of code get the user's numerical unix user id and group id. The userid and group id are needed to assign the proper permissions to the files we pull down from github.</p>
<p>When I first built the function, changing file permissions was not included. I could log onto jupterhub and see the notebooks pulled down from github, but I couldn't run or edit them. The problem was that the notebooks were pulled down from github by a <strong>sudo user</strong> and the jupyterhub user didn't have the permissions to write or execute any of the files. Building the permissions into the function with <code>shutil.chown()</code> solved the problem.</p>
<div class="highlight"><pre><span></span><span class="c1"># in jupyterhub_config.py</span>

<span class="k">def</span> <span class="nf">clone_repo</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">git_url</span><span class="p">,</span> <span class="n">repo_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to clone a github repo into a specific directory of a user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Repo</span><span class="o">.</span><span class="n">clone_from</span><span class="p">(</span><span class="n">git_url</span><span class="p">,</span> <span class="n">repo_dir</span><span class="p">)</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">getpwnam</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">pw_uid</span>
    <span class="n">gid</span> <span class="o">=</span> <span class="n">getpwnam</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">pw_gid</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">chown</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">user</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">gid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">chown</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">user</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">gid</span><span class="p">)</span>
</pre></div>


<p>Now we'll build a pre-spawn hook function that will run when the spawner starts. The function will call the <code>clone_repo()</code> function and pull down the assignments from the github repo the first time a user logs into jupyterhub.  After the assignments and notes are initially created, each subsequent time the user logs into jupyterhub, a new fresh set of assignments and notes are pulled down if <code>ERASE_DIR</code> is set to <code>True</code>. If <code>ERASE_DIR</code> is set to <code>False</code>, once the assignments and notes are downloaded, they will not be over-written.</p>
<p>To run the pre-spawn hook function and the pull repo function, we need to make sure the following imports are present in our jupyterhub_config.py file:</p>
<div class="highlight"><pre><span></span><span class="c1"># jupyterhub_config.py</span>

<span class="kn">import</span> <span class="nn">git</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">pwd</span> <span class="kn">import</span> <span class="n">getpwnam</span>
</pre></div>


<p>The complete pre-spawn hook function is below:</p>
<div class="highlight"><pre><span></span><span class="c1"># in jupyterhub_config.py</span>

<span class="k">def</span> <span class="nf">create_dir_hook</span><span class="p">(</span><span class="n">spawner</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to clone a github repo into a specific directory of a </span>
<span class="sd">   jupyterhub user when the server spawns a new notebook instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">spawner</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span>
    <span class="n">DIR_NAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
    <span class="n">git_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/ProfessorKazarinoff/ENGR101.git&quot;</span>
    <span class="n">repo_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR_NAME</span><span class="p">,</span> <span class="s1">&#39;notebooks&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ERASE_DIR</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">)</span>
        <span class="n">clone_repo</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">git_url</span><span class="p">,</span> <span class="n">repo_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ERASE_DIR</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">)</span>
        <span class="n">clone_repo</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">git_url</span><span class="p">,</span> <span class="n">repo_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ERASE_DIR</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>


<p>The two functions need to be pasted into the jupyterhub_config.py file. Make sure the imports are present as well as an <code>ERASE_DIR = True</code> or <code>ERASE_DIR = False</code> line in the jupyterhub_config.py file too.</p>
<p>Next we need to add a pre-spawn hook function to the spawner object in our jupyterhub_config.py file in the form of</p>
<div class="highlight"><pre><span></span><span class="c1"># in jupyterhub_config.py</span>

<span class="n">c</span><span class="o">.</span><span class="n">Spawner</span><span class="o">.</span><span class="n">pre_spawn_hook</span> <span class="o">=</span> <span class="n">create_dir_hook</span>
</pre></div>


<p>With these changes complete, we can restart jupyterhub using:</p>
<div class="highlight"><pre><span></span>$ sudo systemctl stop jupyterhub
$ sudo systemctl start jupyterhub
$ sudo systemctl status jupyterhub
</pre></div>


<p>To exit the status screen use [Ctrl] + [c]</p>
<p><br></p>
<h3 id="3-create-a-templates-directory-and-populate-it-with-jinja-templates-to-create-a-new-login-page">3. Create a templates directory and populate it with Jinja templates to create a new login page</h3>
<p>The jupyterhub login page looks like this:</p>
<p><img alt="jupyterhub login page" src="/posts/jupyterhub/login_with_google.PNG"></p>
<p>But our college login page looks lik this:</p>
<p><img alt="jupyterhub login page" src="/posts/jupyterhub/college_login_page.PNG"></p>
<p>For users to feel comfortable with logging into the jupyterhub server, we'll make the jupyterhub login page look more like the college login page.</p>
<p>This was a time consuming and fussy task. It involved a lot of messing around with css and html.</p>
<p>First a set of custom jinja templates need to be created. When jupyterhub runs, there is a set directory of jinja templates that build the html users see when they go to the site. These jinga templates are burried deep in the jupyterhub package code. For my jupyterhub installation on the server, I found the jinja template files in the <code>/pkgs</code> directory in <code>anaconda3</code>. If you are using a virtual environment, the jupyterhub package directory name will likey be different:</p>
<div class="highlight"><pre><span></span>/home/peter/anaconda3/pkgs/jupyterhub-0.8.1-py36_0/share/jupyter/hub/templates/
├── 404.html
├── admin.html
├── error.html
├── home.html
├── login.html
├── logout.html
├── page.html
├── spawn.html
├── spawn_pending.html
└── token.html
</pre></div>


<p>Now we need to copy these templates into our home directory. Once copied, we can modify the templates and create a new jupyterhub login page. The <code>login.html</code> file is the one that needs to be customized.</p>
<div class="highlight"><pre><span></span>$ cd /home/peter/anaconda3/pkgs/jupyterhub-0.8.1-py36_0/share/jupyter/hub/
$ cp -R templates /home/peter/templates/
$ cd ~
$ cd templates
$ ls
</pre></div>


<p>Open up the login.html file and modify it with any html that you want to show up when a user goes to the jupyter hub site.</p>
<p>I messed around for WAY to long trying to get my custom login page to look like the college login page. An important piece of html that needs to stay in the login.html file is the <code>&lt;a&gt;</code> tag that links to the authentication url. The complete tag is detailed below</p>
<div class="highlight"><pre><span></span>&lt;!–– login.html ––&gt;

&lt;a role=&quot;button&quot; class=&quot;btn btn-jupyter btn-lg&quot; href=&quot;/hub/oauth_login?next=&quot;&gt;
    Sign in with Portland Community College
&lt;/a&gt;
</pre></div>


<p>I also kept in the jinga tag at the top of the file that brings in all of the formatting from login.html's parent template page.html</p>
<div class="highlight"><pre><span></span>&lt;!–– login.html ––&gt;

{% extends &quot;page.html&quot; %}
</pre></div>


<p>All the changes I made to the login template were inside the "login" block of login.html. You can find my complete login.html file <a href="https://github.com/ProfessorKazarinoff/jupyterhub-svr/blob/master/templates/login.html">here</a></p>
<div class="highlight"><pre><span></span>{% block login %}

&lt;!–– make changes here ––&gt;

{% endblock login %}
</pre></div>


<p>Now we need to modify the jupyterhub_config.py file so that our new set of custom jinja templates are used instead of the default jinja templates.</p>
<p>A problem I initially had was I set the directory path of the custom templates as <code>/home/peter/templates</code> and the login page didn't work as expected. When I changed the directory path to <code>/home/peter/templates/</code> the problem was resolved.</p>
<div class="highlight"><pre><span></span><span class="c1"># jupyterhub_config.py</span>

<span class="c1"># sets a custom html template at the login screen.</span>
<span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">template_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/home/peter/templates/&#39;</span><span class="p">]</span>
</pre></div>


<p><br></p>
<h3 id="4-modify-the-stylemincss-file-to-apply-styling-to-the-login-page">4. Modify the style.min.css file to apply styling to the login page</h3>
<p>Finally the <code>style.min.css</code> file needs to be modified so that the login page styling looks a little more like the college login page.</p>
<p>This is another thing I messed around with for a long time, a WAY to long time. I couldn't figure out a way to get jupyterhub to use a custom .css file. I tried creating a .css file in the new custom templates directory, but jupyterhub wouldn't copy it as a static asset when the server launched. I also tried putting a separate .css file deep inside of the jupyterhub package code. When the server ran, it seemed to copy the custom .css file (I could see the custom .css file using chrome's inspect element tool). But for some reason the custom .css file would be blank when server serve was running, even though the custom .css file contained a whole bunch of css code when viewed deep in the jupyterhub package code.</p>
<p>The solution I finally got to work was modifying the <code>style.min.css</code> file itself that jupyterhub uses. This file is buried deep in the jupyterhub package code:</p>
<div class="highlight"><pre><span></span>home/peter/anaconda3/pkgs/jupyterhub-0.8.1-py36_0/share/jupyter/hub/static/css/
├── style.min.css
└── style.min.css.map
</pre></div>


<p>Modify the <code>style.min.css</code> file to include all the custom css styling desired (find my complete css file <a href="https://github.com/ProfessorKazarinoff/jupyterhub-svr/blob/master/style.min.css">here</a>) With changes to the login.html file and style.min.css file complete, we can restart jupyterhub and view the changes rendered on the login page.</p>
<div class="highlight"><pre><span></span>$ sudo systemctl stop jupyterhub
$ sudo systemctl start jupyterhub
$ sudo systemctl status jupyterhub
</pre></div>


<p>Below is the look of my modified login page in all it's custom html and css glory</p>
<p><img alt="login page image" src="/posts/jupyterhub/custom_login_page.PNG"></p>
<p><br></p>
<h3 id="summary">Summary</h3>
<p>In this post, we will built a pre-spawn hook that pulls down notes and assignments from github and adds it to each user's directory tree when their jupyter notebook server starts. We also constructed a custom login page by creating a custom jinja template (<code>login.html</code>) and modified the <code>style.min.css</code> file inside the jupyterhub package code. The resulting custom login pages looks a lot more like our college login page.</p>
<p><br></p>
<h3 id="conclusion">Conclusion</h3>
<p>This concludes the Jupyter Hub series. We accomplished a lot to get a working version of Jupyter Hub up and running on a Digital Ocean server. Our Jupyter Hub deployment has the following features:</p>
<ul>
<li>Users don't need to install anything to edit and run Python code. Users just need a web browser and an internet connection.</li>
<li>All users have a common set of installed Python packages and don't need to install any extra packages</li>
<li>A custom domain name is hooked to jupyterhub instead of a numeric IP address</li>
<li>jupyterhub runs on https and has SSL security</li>
<li>Users can log into jupyterhub using their college usernames and passwords</li>
<li>Each user's directory tree is pre-populated with assignments and notes pulled down from github</li>
<li>The pre-populated assignments and notes can be run and modified by users.</li>
</ul>
<p>You can find the notes and assignments that pre-poplulate into each user's directory tree <a href="https://github.com/ProfessorKazarinoff/ENGR101">here</a></p>
<p>You can find the various files that are part of the jupyterhub deployment <a href="https://github.com/ProfessorKazarinoff/jupyterhub-svr">here</a></p>
<p>I Hope this series is helpful to anyone who wants to set up Jupyter Hub for their own class or team. After the course runs, I want to post the results of students using Jupyter Hub. The first course to use Jupyter Hub runs this summer quarter.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="/results-from-running-jupyter-hub-for-a-quarter.html">Results from Running Jupyter Hub in a College Class</a></li>
        <li><a href="/first-live-results-running-jupyter-hub.html">First Live Results Running Jupyter Hub in a College Class</a></li>
        <li><a href="/add-google-oauth-and-system-service-to-jupyterhub.html">Adding Google OAuth and system service to a Jupyter Hub server</a></li>
        <li><a href="/add-ssl-and-domain-name-to-jupyterhub.html">Adding SSL and a domain name to Jupyter Hub</a></li>
        <li><a href="/installing-jupyter-hub.html">Installing Jupyterhub</a></li>
    </ul>
</section>
<section class="well" id="related-posts">
    <h4>Article 7 of the Jupyter Hub series</h4>
       <h5>Previous articles</h5>
       <ul>
           <li><a href="/why-jupyter-hub.html">Why Jupyter Hub?</a></li>
           <li><a href="/ssh-keys-with-putty.html">Create an SSH Key with PuTTYgen</a></li>
           <li><a href="/new-digital-ocean-droplet.html">Creating a new Digital Ocean Droplet</a></li>
           <li><a href="/installing-jupyter-hub.html">Installing Jupyterhub</a></li>
           <li><a href="/add-ssl-and-domain-name-to-jupyterhub.html">Adding SSL and a domain name to Jupyter Hub</a></li>
           <li><a href="/add-google-oauth-and-system-service-to-jupyterhub.html">Adding Google OAuth and system service to a Jupyter Hub server</a></li>
       </ul>
       <h5>Next articles</h5>
       <ul>
           <li><a href="/first-live-results-running-jupyter-hub.html">First Live Results Running Jupyter Hub in a College Class</a></li>
           <li><a href="/results-from-running-jupyter-hub-for-a-quarter.html">Results from Running Jupyter Hub in a College Class</a></li>
       </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="/extra/gear-wrench-icon-512-278694.png"/>
        </p>
    <p>
      <strong>About Peter Kazarinoff</strong><br/>
        I teach engineering at a community college in the Pacific Northwest. I am interested in programming and how to help students. Here I mostly blog about Python, MATLAB and how programing can be incorporated into engineering education.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="/results-from-running-jupyter-hub-for-a-quarter.html">Results from Running Jupyter Hub in a College Class</a></li>
    <li class="list-group-item"><a href="/flask-iot-server-validation-time-stamps.html">Building an IoT Server with flask and Python - Part 4 Validation and Timestamps</a></li>
    <li class="list-group-item"><a href="/circuit-diagram-problem-with-schemdraw.html">Solving a Circuit Diagram Problem with Python and SchemDraw</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-4">
      <a href="/tag/engineering.html">engineering</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/esp8266.html">esp8266</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/jupyter.html">jupyter</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/jupyter-hub.html">jupyter hub</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/jupyter-notebooks.html">jupyter notebooks</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/microcontroller.html">microcontroller</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/micropython.html">micropython</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="/tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/sensor.html">sensor</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Series -->
<li class="list-group-item">
  <h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Series</span></h4>
  <ul class="list-group">
    <li class="list-group-item">
      <h5></i>Previous article</h5>
      <a href="/add-google-oauth-and-system-service-to-jupyterhub.html">Adding Google OAuth and system service to a Jupyter Hub server</a>
    </li>
    <li class="list-group-item">
      <h5>Next article</h5>
      <a href="/first-live-results-running-jupyter-hub.html">First Live Results Running Jupyter Hub in a College Class</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Series -->


<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/professorkazarinoff">@professorkazarinoff</a> on GitHub
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Peter Kazarinoff
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <script src="/static/js/custom.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'professorkazarinoff',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-116330557-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

<script type="text/javascript">
jQuery(document).ready(function($) {
    $("div.collapseheader").click(function () {
    $header = $(this).children("span").first();
    $codearea = $(this).children(".input_area");
    console.log($(this).children());
    $codearea.slideToggle(500, function () {
        $header.text(function () {
            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
        });
    });
});
});
</script>
</body>
</html>